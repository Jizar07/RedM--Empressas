"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/webhook/channel-messages/route";
exports.ids = ["app/api/webhook/channel-messages/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "fs":
/*!*********************!*\
  !*** external "fs" ***!
  \*********************/
/***/ ((module) => {

module.exports = require("fs");

/***/ }),

/***/ "path":
/*!***********************!*\
  !*** external "path" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("path");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&page=%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhook%2Fchannel-messages%2Froute.ts&appDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&page=%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhook%2Fchannel-messages%2Froute.ts&appDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_jizar_OneDrive_Documents_DiscordBot_frontend_app_api_webhook_channel_messages_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/webhook/channel-messages/route.ts */ \"(rsc)/./app/api/webhook/channel-messages/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/webhook/channel-messages/route\",\n        pathname: \"/api/webhook/channel-messages\",\n        filename: \"route\",\n        bundlePath: \"app/api/webhook/channel-messages/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\jizar\\\\OneDrive\\\\Documents\\\\DiscordBot\\\\frontend\\\\app\\\\api\\\\webhook\\\\channel-messages\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_jizar_OneDrive_Documents_DiscordBot_frontend_app_api_webhook_channel_messages_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/webhook/channel-messages/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ3ZWJob29rJTJGY2hhbm5lbC1tZXNzYWdlcyUyRnJvdXRlJnBhZ2U9JTJGYXBpJTJGd2ViaG9vayUyRmNoYW5uZWwtbWVzc2FnZXMlMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZ3ZWJob29rJTJGY2hhbm5lbC1tZXNzYWdlcyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNqaXphciU1Q09uZURyaXZlJTVDRG9jdW1lbnRzJTVDRGlzY29yZEJvdCU1Q2Zyb250ZW5kJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNqaXphciU1Q09uZURyaXZlJTVDRG9jdW1lbnRzJTVDRGlzY29yZEJvdCU1Q2Zyb250ZW5kJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUMwRDtBQUN2STtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZG0tZGFzaGJvYXJkLz83YjdjIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUtbW9kdWxlcy9hcHAtcm91dGUvbW9kdWxlLmNvbXBpbGVkXCI7XG5pbXBvcnQgeyBSb3V0ZUtpbmQgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9mdXR1cmUvcm91dGUta2luZFwiO1xuaW1wb3J0IHsgcGF0Y2hGZXRjaCBhcyBfcGF0Y2hGZXRjaCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL2xpYi9wYXRjaC1mZXRjaFwiO1xuaW1wb3J0ICogYXMgdXNlcmxhbmQgZnJvbSBcIkM6XFxcXFVzZXJzXFxcXGppemFyXFxcXE9uZURyaXZlXFxcXERvY3VtZW50c1xcXFxEaXNjb3JkQm90XFxcXGZyb250ZW5kXFxcXGFwcFxcXFxhcGlcXFxcd2ViaG9va1xcXFxjaGFubmVsLW1lc3NhZ2VzXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS93ZWJob29rL2NoYW5uZWwtbWVzc2FnZXMvcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS93ZWJob29rL2NoYW5uZWwtbWVzc2FnZXNcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3dlYmhvb2svY2hhbm5lbC1tZXNzYWdlcy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXGppemFyXFxcXE9uZURyaXZlXFxcXERvY3VtZW50c1xcXFxEaXNjb3JkQm90XFxcXGZyb250ZW5kXFxcXGFwcFxcXFxhcGlcXFxcd2ViaG9va1xcXFxjaGFubmVsLW1lc3NhZ2VzXFxcXHJvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS93ZWJob29rL2NoYW5uZWwtbWVzc2FnZXMvcm91dGVcIjtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgc2VydmVySG9va3MsXG4gICAgICAgIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcywgb3JpZ2luYWxQYXRobmFtZSwgcGF0Y2hGZXRjaCwgIH07XG5cbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWFwcC1yb3V0ZS5qcy5tYXAiXSwibmFtZXMiOltdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&page=%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhook%2Fchannel-messages%2Froute.ts&appDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/webhook/channel-messages/route.ts":
/*!***************************************************!*\
  !*** ./app/api/webhook/channel-messages/route.ts ***!
  \***************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! fs */ \"fs\");\n/* harmony import */ var fs__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(fs__WEBPACK_IMPORTED_MODULE_1__);\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! path */ \"path\");\n/* harmony import */ var path__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(path__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _sse_route__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ../sse/route */ \"(rsc)/./app/api/webhook/sse/route.ts\");\n\n\n\n\n// CORS headers\nconst corsHeaders = {\n    \"Access-Control-Allow-Origin\": \"*\",\n    \"Access-Control-Allow-Methods\": \"GET, POST, OPTIONS\",\n    \"Access-Control-Allow-Headers\": \"Content-Type, Origin, Accept\",\n    \"Access-Control-Max-Age\": \"86400\"\n};\nfunction withCors(response) {\n    Object.entries(corsHeaders).forEach(([key, value])=>{\n        response.headers.set(key, value);\n    });\n    return response;\n}\n// Store messages in a JSON file in the public directory\nconst MESSAGES_FILE = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"discord-messages.json\");\n// Ensure the public directory exists\nfunction ensurePublicDirectory() {\n    const publicDir = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\");\n    if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(publicDir)) {\n        fs__WEBPACK_IMPORTED_MODULE_1___default().mkdirSync(publicDir, {\n            recursive: true\n        });\n    }\n}\n// Read existing messages from file\nfunction readMessages() {\n    try {\n        ensurePublicDirectory();\n        if (!fs__WEBPACK_IMPORTED_MODULE_1___default().existsSync(MESSAGES_FILE)) {\n            return [];\n        }\n        const fileContent = fs__WEBPACK_IMPORTED_MODULE_1___default().readFileSync(MESSAGES_FILE, \"utf-8\");\n        const data = JSON.parse(fileContent);\n        return Array.isArray(data.messages) ? data.messages : [];\n    } catch (error) {\n        console.error(\"Error reading messages file:\", error);\n        return [];\n    }\n}\n// Write messages to file\nfunction writeMessages(messages) {\n    try {\n        ensurePublicDirectory();\n        const data = {\n            lastUpdated: new Date().toISOString(),\n            totalMessages: messages.length,\n            messages: messages\n        };\n        fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(MESSAGES_FILE, JSON.stringify(data, null, 2));\n        console.log(`âœ… Saved ${messages.length} messages to discord-messages.json`);\n    } catch (error) {\n        console.error(\"Error writing messages file:\", error);\n        throw error;\n    }\n}\nasync function POST(request) {\n    try {\n        const body = await request.json();\n        if (!body.channelId || !Array.isArray(body.messages)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Invalid payload format\"\n            }, {\n                status: 400\n            });\n        }\n        // Read existing messages\n        const existingMessages = readMessages();\n        const existingIds = new Set(existingMessages.map((msg)=>msg.id));\n        // Simple deduplication based only on message ID and timestamp\n        const newMessages = body.messages.filter((msg)=>{\n            // Only check if we've seen this exact message ID before\n            if (existingIds.has(msg.id)) {\n                return false;\n            }\n            // Also check for same timestamp to catch rapid duplicates\n            const msgTimestamp = new Date(msg.timestamp).getTime();\n            const duplicateByTime = existingMessages.some((existing)=>Math.abs(new Date(existing.timestamp).getTime() - msgTimestamp) < 1000 // Within 1 second\n                 && existing.author === msg.author);\n            return !duplicateByTime;\n        });\n        if (newMessages.length === 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: true,\n                message: \"No new messages to process\",\n                total: existingMessages.length\n            });\n        }\n        // Merge with existing messages\n        const allMessages = [\n            ...existingMessages,\n            ...newMessages\n        ];\n        // Keep only the most recent 1000 messages to prevent file from growing too large\n        const recentMessages = allMessages.sort((a, b)=>new Date(b.timestamp).getTime() - new Date(a.timestamp).getTime()).slice(0, 1000);\n        // Write to file\n        writeMessages(recentMessages);\n        console.log(`ðŸ“ Processed ${newMessages.length} new messages from channel ${body.channelId}`);\n        // Create a simple notification mechanism using a timestamp file\n        // This will allow the frontend to detect when new data is available\n        const notificationFile = path__WEBPACK_IMPORTED_MODULE_2___default().join(process.cwd(), \"public\", \"last-update.json\");\n        try {\n            const updateInfo = {\n                lastUpdate: new Date().toISOString(),\n                newMessages: newMessages.length,\n                totalMessages: recentMessages.length,\n                timestamp: Date.now() // Add timestamp for easier comparison\n            };\n            fs__WEBPACK_IMPORTED_MODULE_1___default().writeFileSync(notificationFile, JSON.stringify(updateInfo));\n            console.log(\"\\uD83D\\uDCE1 Created update notification for frontend\");\n            // NOTIFY SSE CLIENTS IMMEDIATELY\n            try {\n                (0,_sse_route__WEBPACK_IMPORTED_MODULE_3__.notifyClients)({\n                    type: \"new-messages\",\n                    count: newMessages.length,\n                    total: recentMessages.length,\n                    timestamp: new Date().toISOString()\n                });\n                console.log(`ðŸš€ Notified SSE clients of ${newMessages.length} new messages`);\n            } catch (sseError) {\n                console.error(\"Failed to notify SSE clients:\", sseError);\n            }\n        } catch (error) {\n            console.warn(\"Could not write notification file:\", error);\n        }\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: `Processed ${newMessages.length} new messages`,\n            newMessages: newMessages.length,\n            total: recentMessages.length,\n            lastUpdate: new Date().toISOString()\n        }));\n    } catch (error) {\n        console.error(\"Error processing webhook:\", error);\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Internal server error\"\n        }, {\n            status: 500\n        }));\n    }\n}\nfunction OPTIONS(request) {\n    return withCors(new Response(null, {\n        status: 200\n    }));\n}\n// Discord message parser - converts raw messages to activity data\nfunction parseDiscordMessage(message) {\n    try {\n        const content = message.content.trim();\n        // Parse Spidey Bot messages for farm activities\n        // Try CAIXA messages first (deposits/withdrawals) - they don't have \"Autor:\" field\n        const caixaMatch = content.match(/REGISTRO - fazenda_86\\s*CAIXA ORGANIZAÃ‡ÃƒO\\s*-\\s*(DEPÃ“SITO|SAQUE)(.+?)Autor:(.+?)\\s*\\|\\s*FIXO:\\s*(\\d+)/s);\n        if (caixaMatch) {\n            const transactionType = caixaMatch[1].trim();\n            const actionPart = caixaMatch[2].trim();\n            const autor = caixaMatch[3].trim();\n            if (transactionType === \"DEP\\xd3SITO\") {\n                // Parse DEPÃ“SITO (deposit money) - with \"AÃ§Ã£o:\" (for sales/actions)\n                const depositWithActionMatch = actionPart.match(/Valor depositado:\\s*\\$([0-9,.]+)\\s*AÃ§Ã£o:(.+?)Saldo apÃ³s depÃ³sito:\\s*\\$([0-9,.]+)/);\n                if (depositWithActionMatch) {\n                    const valor = parseFloat(depositWithActionMatch[1].replace(\",\", \"\"));\n                    const acao = depositWithActionMatch[2].trim();\n                    const saldo = parseFloat(depositWithActionMatch[3].replace(\",\", \"\"));\n                    return {\n                        ...message,\n                        parseSuccess: true,\n                        tipo: \"venda\",\n                        categoria: \"financeiro\",\n                        valor: valor,\n                        autor: autor,\n                        descricao: acao,\n                        displayText: `${autor} ${acao} por $${valor.toFixed(2)}`,\n                        confidence: \"high\"\n                    };\n                }\n            } else if (transactionType === \"SAQUE\") {\n                // Parse SAQUE (withdraw money)\n                const withdrawMatch = actionPart.match(/Valor sacado:\\s*\\$([0-9,.]+).*?Saldo apÃ³s saque:\\s*\\$([0-9,.]+)/s);\n                if (withdrawMatch) {\n                    const valor = parseFloat(withdrawMatch[1].replace(\",\", \"\"));\n                    const saldo = parseFloat(withdrawMatch[3].replace(\",\", \"\"));\n                    return {\n                        ...message,\n                        parseSuccess: true,\n                        tipo: \"saque\",\n                        categoria: \"financeiro\",\n                        valor: valor,\n                        autor: autor,\n                        descricao: `Saque de $${valor.toFixed(2)}`,\n                        displayText: `${autor} sacou $${valor.toFixed(2)} do caixa`,\n                        confidence: \"high\"\n                    };\n                }\n            }\n        }\n        // Then try BAÃš messages (inventory) - they have \"Autor:\" field\n        const spideyBotMatch = content.match(/REGISTRO - fazenda_86(.+?)Autor:(.+?)\\s*\\|\\s*FIXO:\\s*(\\d+)/s);\n        if (spideyBotMatch) {\n            const actionPart = spideyBotMatch[1].trim();\n            const autor = spideyBotMatch[2].trim();\n            // Parse INSERIR ITEM (add item)\n            const addMatch = actionPart.match(/INSERIR ITEM\\s*Item adicionado:\\s*(.+?)\\s*x(\\d+)/);\n            if (addMatch) {\n                return {\n                    ...message,\n                    parseSuccess: true,\n                    tipo: \"adicionar\",\n                    categoria: \"inventario\",\n                    item: addMatch[1].trim(),\n                    quantidade: parseInt(addMatch[2]),\n                    autor: autor,\n                    displayText: `${autor} adicionou ${addMatch[2]}x ${addMatch[1]}`\n                };\n            }\n            // Parse REMOVER ITEM (remove item)  \n            const removeMatch = actionPart.match(/REMOVER ITEM\\s*Item removido:\\s*(.+?)\\s*x(\\d+)/);\n            if (removeMatch) {\n                return {\n                    ...message,\n                    parseSuccess: true,\n                    tipo: \"remover\",\n                    categoria: \"inventario\",\n                    item: removeMatch[1].trim(),\n                    quantidade: parseInt(removeMatch[2]),\n                    autor: autor,\n                    displayText: `${autor} removeu ${removeMatch[2]}x ${removeMatch[1]}`\n                };\n            }\n        }\n        // Try to parse other message formats (fallback patterns)\n        const itemAddPattern = /(?:Item adicionado|adicionou):\\s*(.+?)\\s*x(\\d+)/i;\n        const itemRemovePattern = /(?:Item removido|removeu):\\s*(.+?)\\s*x(\\d+)/i;\n        const moneyPattern = /\\$([0-9,.]+)/;\n        const addMatch = content.match(itemAddPattern);\n        if (addMatch) {\n            return {\n                ...message,\n                parseSuccess: true,\n                tipo: \"adicionar\",\n                categoria: \"inventario\",\n                item: addMatch[1].trim(),\n                quantidade: parseInt(addMatch[2]),\n                autor: message.author || \"Sistema\",\n                displayText: `${message.author} adicionou ${addMatch[2]}x ${addMatch[1]}`\n            };\n        }\n        const removeMatch = content.match(itemRemovePattern);\n        if (removeMatch) {\n            return {\n                ...message,\n                parseSuccess: true,\n                tipo: \"remover\",\n                categoria: \"inventario\",\n                item: removeMatch[1].trim(),\n                quantidade: parseInt(removeMatch[2]),\n                autor: message.author || \"Sistema\",\n                displayText: `${message.author} removeu ${removeMatch[2]}x ${removeMatch[1]}`\n            };\n        }\n        // Parse SAQUE (withdrawal) messages - format: Zero Bala sacou $2000 do caixa\n        if (content.includes(\"SAQUE\") && content.includes(\"Valor sacado:\")) {\n            const valorMatch = content.match(/Valor sacado:\\s*\\$([0-9,.]+)/);\n            const autorMatch = content.match(/Autor:(.+?)\\s*\\|/);\n            if (valorMatch && autorMatch) {\n                const valor = parseFloat(valorMatch[1].replace(\",\", \"\"));\n                const autorSaque = autorMatch[1].trim();\n                return {\n                    ...message,\n                    parseSuccess: true,\n                    tipo: \"saque\",\n                    categoria: \"financeiro\",\n                    valor: valor,\n                    autor: autorSaque,\n                    descricao: `Saque de $${valor.toFixed(2)}`,\n                    displayText: `sacou do caixa`\n                };\n            }\n        }\n        // Parse DEPÃ“SITO (deposit) messages - format: jack sparrow vendeu 4 animais no matadouro por $160\n        if (content.includes(\"DEP\\xd3SITO\") && content.includes(\"Valor depositado:\")) {\n            const valorMatch = content.match(/Valor depositado:\\s*\\$([0-9,.]+)/);\n            const acaoMatch = content.match(/AÃ§Ã£o:(.+?)Saldo apÃ³s depÃ³sito:/);\n            if (valorMatch && acaoMatch) {\n                const valor = parseFloat(valorMatch[1].replace(\",\", \"\"));\n                const acao = acaoMatch[1].trim();\n                // Extract author from action \"jack sparrow vendeu 4 animais no matadouro\"\n                const vendeuMatch = acao.match(/^(.+?)\\s+vendeu\\s+(\\d+)\\s+animais\\s+no\\s+matadouro/);\n                if (vendeuMatch) {\n                    const autorDeposito = vendeuMatch[1].trim();\n                    const quantidade = vendeuMatch[2];\n                    return {\n                        ...message,\n                        parseSuccess: true,\n                        tipo: \"deposito\",\n                        categoria: \"financeiro\",\n                        valor: valor,\n                        autor: autorDeposito,\n                        descricao: `Vendeu ${quantidade} animais no matadouro`,\n                        displayText: `vendeu ${quantidade} animais no matadouro por`\n                    };\n                }\n                // Fallback for other deposit actions\n                return {\n                    ...message,\n                    parseSuccess: true,\n                    tipo: \"deposito\",\n                    categoria: \"financeiro\",\n                    valor: valor,\n                    autor: \"Sistema\",\n                    descricao: acao,\n                    displayText: `Sistema depositou $${valor.toFixed(2)} no caixa`\n                };\n            }\n        }\n        const moneyMatch = content.match(moneyPattern);\n        if (moneyMatch && (content.toLowerCase().includes(\"deposit\") || content.toLowerCase().includes(\"saque\") || content.toLowerCase().includes(\"vendeu\"))) {\n            const valor = parseFloat(moneyMatch[1].replace(\",\", \"\"));\n            return {\n                ...message,\n                parseSuccess: true,\n                tipo: content.toLowerCase().includes(\"saque\") ? \"saque\" : \"deposito\",\n                categoria: \"financeiro\",\n                valor: valor,\n                autor: message.author || \"Sistema\",\n                displayText: content.substring(0, 100)\n            };\n        }\n        // Return unparsed message\n        return {\n            ...message,\n            parseSuccess: false,\n            categoria: \"sistema\",\n            displayText: content.substring(0, 100)\n        };\n    } catch (error) {\n        console.error(\"Parse error:\", error);\n        return {\n            ...message,\n            parseSuccess: false,\n            categoria: \"sistema\",\n            displayText: message.content.substring(0, 100)\n        };\n    }\n}\nasync function GET(request) {\n    try {\n        const messages = readMessages();\n        // Parse all messages and return parsed activities\n        const parsedMessages = messages.map(parseDiscordMessage);\n        console.log(`ðŸ“Š Parsed ${parsedMessages.length} messages, ${parsedMessages.filter((m)=>m.parseSuccess).length} successfully parsed`);\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            messages: parsedMessages,\n            total: parsedMessages.length,\n            lastUpdated: messages.length > 0 ? messages[0]?.timestamp : null,\n            parsed: parsedMessages.filter((m)=>m.parseSuccess).length\n        }));\n    } catch (error) {\n        console.error(\"Error reading messages:\", error);\n        return withCors(next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to read messages\"\n        }, {\n            status: 500\n        }));\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dlYmhvb2svY2hhbm5lbC1tZXNzYWdlcy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBeUQ7QUFDckM7QUFDSTtBQUNxQjtBQWlCN0MsZUFBZTtBQUNmLE1BQU1JLGNBQWM7SUFDbEIsK0JBQStCO0lBQy9CLGdDQUFnQztJQUNoQyxnQ0FBZ0M7SUFDaEMsMEJBQTBCO0FBQzVCO0FBRUEsU0FBU0MsU0FBU0MsUUFBa0I7SUFDbENDLE9BQU9DLE9BQU8sQ0FBQ0osYUFBYUssT0FBTyxDQUFDLENBQUMsQ0FBQ0MsS0FBS0MsTUFBTTtRQUMvQ0wsU0FBU00sT0FBTyxDQUFDQyxHQUFHLENBQUNILEtBQUtDO0lBQzVCO0lBQ0EsT0FBT0w7QUFDVDtBQUVBLHdEQUF3RDtBQUN4RCxNQUFNUSxnQkFBZ0JaLGdEQUFTLENBQUNjLFFBQVFDLEdBQUcsSUFBSSxVQUFVO0FBRXpELHFDQUFxQztBQUNyQyxTQUFTQztJQUNQLE1BQU1DLFlBQVlqQixnREFBUyxDQUFDYyxRQUFRQyxHQUFHLElBQUk7SUFDM0MsSUFBSSxDQUFDaEIsb0RBQWEsQ0FBQ2tCLFlBQVk7UUFDN0JsQixtREFBWSxDQUFDa0IsV0FBVztZQUFFRyxXQUFXO1FBQUs7SUFDNUM7QUFDRjtBQUVBLG1DQUFtQztBQUNuQyxTQUFTQztJQUNQLElBQUk7UUFDRkw7UUFFQSxJQUFJLENBQUNqQixvREFBYSxDQUFDYSxnQkFBZ0I7WUFDakMsT0FBTyxFQUFFO1FBQ1g7UUFFQSxNQUFNVSxjQUFjdkIsc0RBQWUsQ0FBQ2EsZUFBZTtRQUNuRCxNQUFNWSxPQUFPQyxLQUFLQyxLQUFLLENBQUNKO1FBQ3hCLE9BQU9LLE1BQU1DLE9BQU8sQ0FBQ0osS0FBS0ssUUFBUSxJQUFJTCxLQUFLSyxRQUFRLEdBQUcsRUFBRTtJQUMxRCxFQUFFLE9BQU9DLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLGdDQUFnQ0E7UUFDOUMsT0FBTyxFQUFFO0lBQ1g7QUFDRjtBQUVBLHlCQUF5QjtBQUN6QixTQUFTRSxjQUFjSCxRQUF1QjtJQUM1QyxJQUFJO1FBQ0ZiO1FBRUEsTUFBTVEsT0FBTztZQUNYUyxhQUFhLElBQUlDLE9BQU9DLFdBQVc7WUFDbkNDLGVBQWVQLFNBQVNRLE1BQU07WUFDOUJSLFVBQVVBO1FBQ1o7UUFFQTlCLHVEQUFnQixDQUFDYSxlQUFlYSxLQUFLYyxTQUFTLENBQUNmLE1BQU0sTUFBTTtRQUMzRE8sUUFBUVMsR0FBRyxDQUFDLENBQUMsUUFBUSxFQUFFWCxTQUFTUSxNQUFNLENBQUMsa0NBQWtDLENBQUM7SUFDNUUsRUFBRSxPQUFPUCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxnQ0FBZ0NBO1FBQzlDLE1BQU1BO0lBQ1I7QUFDRjtBQUVPLGVBQWVXLEtBQUtDLE9BQW9CO0lBQzdDLElBQUk7UUFDRixNQUFNQyxPQUF1QixNQUFNRCxRQUFRRSxJQUFJO1FBRS9DLElBQUksQ0FBQ0QsS0FBS0UsU0FBUyxJQUFJLENBQUNsQixNQUFNQyxPQUFPLENBQUNlLEtBQUtkLFFBQVEsR0FBRztZQUNwRCxPQUFPL0IscURBQVlBLENBQUM4QyxJQUFJLENBQ3RCO2dCQUFFRSxTQUFTO2dCQUFPaEIsT0FBTztZQUF5QixHQUNsRDtnQkFBRWlCLFFBQVE7WUFBSTtRQUVsQjtRQUVBLHlCQUF5QjtRQUN6QixNQUFNQyxtQkFBbUIzQjtRQUN6QixNQUFNNEIsY0FBYyxJQUFJQyxJQUFJRixpQkFBaUJHLEdBQUcsQ0FBQ0MsQ0FBQUEsTUFBT0EsSUFBSUMsRUFBRTtRQUU5RCw4REFBOEQ7UUFDOUQsTUFBTUMsY0FBY1gsS0FBS2QsUUFBUSxDQUFDMEIsTUFBTSxDQUFDSCxDQUFBQTtZQUN2Qyx3REFBd0Q7WUFDeEQsSUFBSUgsWUFBWU8sR0FBRyxDQUFDSixJQUFJQyxFQUFFLEdBQUc7Z0JBQzNCLE9BQU87WUFDVDtZQUVBLDBEQUEwRDtZQUMxRCxNQUFNSSxlQUFlLElBQUl2QixLQUFLa0IsSUFBSU0sU0FBUyxFQUFFQyxPQUFPO1lBQ3BELE1BQU1DLGtCQUFrQlosaUJBQWlCYSxJQUFJLENBQUNDLENBQUFBLFdBQzVDQyxLQUFLQyxHQUFHLENBQUMsSUFBSTlCLEtBQUs0QixTQUFTSixTQUFTLEVBQUVDLE9BQU8sS0FBS0YsZ0JBQWdCLEtBQUssa0JBQWtCO29CQUN0RkssU0FBU0csTUFBTSxLQUFLYixJQUFJYSxNQUFNO1lBR25DLE9BQU8sQ0FBQ0w7UUFDVjtRQUVBLElBQUlOLFlBQVlqQixNQUFNLEtBQUssR0FBRztZQUM1QixPQUFPdkMscURBQVlBLENBQUM4QyxJQUFJLENBQUM7Z0JBQ3ZCRSxTQUFTO2dCQUNUb0IsU0FBUztnQkFDVEMsT0FBT25CLGlCQUFpQlgsTUFBTTtZQUNoQztRQUNGO1FBRUEsK0JBQStCO1FBQy9CLE1BQU0rQixjQUFjO2VBQUlwQjtlQUFxQk07U0FBWTtRQUV6RCxpRkFBaUY7UUFDakYsTUFBTWUsaUJBQWlCRCxZQUNwQkUsSUFBSSxDQUFDLENBQUNDLEdBQUdDLElBQU0sSUFBSXRDLEtBQUtzQyxFQUFFZCxTQUFTLEVBQUVDLE9BQU8sS0FBSyxJQUFJekIsS0FBS3FDLEVBQUViLFNBQVMsRUFBRUMsT0FBTyxJQUM5RWMsS0FBSyxDQUFDLEdBQUc7UUFFWixnQkFBZ0I7UUFDaEJ6QyxjQUFjcUM7UUFFZHRDLFFBQVFTLEdBQUcsQ0FBQyxDQUFDLGFBQWEsRUFBRWMsWUFBWWpCLE1BQU0sQ0FBQywyQkFBMkIsRUFBRU0sS0FBS0UsU0FBUyxDQUFDLENBQUM7UUFFNUYsZ0VBQWdFO1FBQ2hFLG9FQUFvRTtRQUNwRSxNQUFNNkIsbUJBQW1CMUUsZ0RBQVMsQ0FBQ2MsUUFBUUMsR0FBRyxJQUFJLFVBQVU7UUFDNUQsSUFBSTtZQUNGLE1BQU00RCxhQUFhO2dCQUNqQkMsWUFBWSxJQUFJMUMsT0FBT0MsV0FBVztnQkFDbENtQixhQUFhQSxZQUFZakIsTUFBTTtnQkFDL0JELGVBQWVpQyxlQUFlaEMsTUFBTTtnQkFDcENxQixXQUFXeEIsS0FBSzJDLEdBQUcsR0FBRyxzQ0FBc0M7WUFDOUQ7WUFDQTlFLHVEQUFnQixDQUFDMkUsa0JBQWtCakQsS0FBS2MsU0FBUyxDQUFDb0M7WUFDbEQ1QyxRQUFRUyxHQUFHLENBQUM7WUFFWixpQ0FBaUM7WUFDakMsSUFBSTtnQkFDRnZDLHlEQUFhQSxDQUFDO29CQUNaNkUsTUFBTTtvQkFDTkMsT0FBT3pCLFlBQVlqQixNQUFNO29CQUN6QjhCLE9BQU9FLGVBQWVoQyxNQUFNO29CQUM1QnFCLFdBQVcsSUFBSXhCLE9BQU9DLFdBQVc7Z0JBQ25DO2dCQUNBSixRQUFRUyxHQUFHLENBQUMsQ0FBQywyQkFBMkIsRUFBRWMsWUFBWWpCLE1BQU0sQ0FBQyxhQUFhLENBQUM7WUFDN0UsRUFBRSxPQUFPMkMsVUFBVTtnQkFDakJqRCxRQUFRRCxLQUFLLENBQUMsaUNBQWlDa0Q7WUFDakQ7UUFDRixFQUFFLE9BQU9sRCxPQUFPO1lBQ2RDLFFBQVFrRCxJQUFJLENBQUMsc0NBQXNDbkQ7UUFDckQ7UUFFQSxPQUFPM0IsU0FBU0wscURBQVlBLENBQUM4QyxJQUFJLENBQUM7WUFDaENFLFNBQVM7WUFDVG9CLFNBQVMsQ0FBQyxVQUFVLEVBQUVaLFlBQVlqQixNQUFNLENBQUMsYUFBYSxDQUFDO1lBQ3ZEaUIsYUFBYUEsWUFBWWpCLE1BQU07WUFDL0I4QixPQUFPRSxlQUFlaEMsTUFBTTtZQUM1QnVDLFlBQVksSUFBSTFDLE9BQU9DLFdBQVc7UUFDcEM7SUFFRixFQUFFLE9BQU9MLE9BQU87UUFDZEMsUUFBUUQsS0FBSyxDQUFDLDZCQUE2QkE7UUFDM0MsT0FBTzNCLFNBQVNMLHFEQUFZQSxDQUFDOEMsSUFBSSxDQUMvQjtZQUFFRSxTQUFTO1lBQU9oQixPQUFPO1FBQXdCLEdBQ2pEO1lBQUVpQixRQUFRO1FBQUk7SUFFbEI7QUFDRjtBQUVPLFNBQVNtQyxRQUFReEMsT0FBb0I7SUFDMUMsT0FBT3ZDLFNBQVMsSUFBSWdGLFNBQVMsTUFBTTtRQUFFcEMsUUFBUTtJQUFJO0FBQ25EO0FBRUEsa0VBQWtFO0FBQ2xFLFNBQVNxQyxvQkFBb0JsQixPQUFvQjtJQUMvQyxJQUFJO1FBQ0YsTUFBTW1CLFVBQVVuQixRQUFRbUIsT0FBTyxDQUFDQyxJQUFJO1FBR3BDLGdEQUFnRDtRQUNoRCxtRkFBbUY7UUFDbkYsTUFBTUMsYUFBYUYsUUFBUUcsS0FBSyxDQUFDO1FBQ2pDLElBQUlELFlBQVk7WUFDZCxNQUFNRSxrQkFBa0JGLFVBQVUsQ0FBQyxFQUFFLENBQUNELElBQUk7WUFDMUMsTUFBTUksYUFBYUgsVUFBVSxDQUFDLEVBQUUsQ0FBQ0QsSUFBSTtZQUNyQyxNQUFNSyxRQUFRSixVQUFVLENBQUMsRUFBRSxDQUFDRCxJQUFJO1lBRWhDLElBQUlHLG9CQUFvQixlQUFZO2dCQUNsQyxvRUFBb0U7Z0JBQ3BFLE1BQU1HLHlCQUF5QkYsV0FBV0YsS0FBSyxDQUFDO2dCQUNoRCxJQUFJSSx3QkFBd0I7b0JBQzFCLE1BQU1DLFFBQVFDLFdBQVdGLHNCQUFzQixDQUFDLEVBQUUsQ0FBQ0csT0FBTyxDQUFDLEtBQUs7b0JBQ2hFLE1BQU1DLE9BQU9KLHNCQUFzQixDQUFDLEVBQUUsQ0FBQ04sSUFBSTtvQkFDM0MsTUFBTVcsUUFBUUgsV0FBV0Ysc0JBQXNCLENBQUMsRUFBRSxDQUFDRyxPQUFPLENBQUMsS0FBSztvQkFFaEUsT0FBTzt3QkFDTCxHQUFHN0IsT0FBTzt3QkFDVmdDLGNBQWM7d0JBQ2RDLE1BQU07d0JBQ05DLFdBQVc7d0JBQ1hQLE9BQU9BO3dCQUNQRixPQUFPQTt3QkFDUFUsV0FBV0w7d0JBQ1hNLGFBQWEsQ0FBQyxFQUFFWCxNQUFNLENBQUMsRUFBRUssS0FBSyxNQUFNLEVBQUVILE1BQU1VLE9BQU8sQ0FBQyxHQUFHLENBQUM7d0JBQ3hEQyxZQUFZO29CQUNkO2dCQUNGO1lBQ0YsT0FBTyxJQUFJZixvQkFBb0IsU0FBUztnQkFDdEMsK0JBQStCO2dCQUMvQixNQUFNZ0IsZ0JBQWdCZixXQUFXRixLQUFLLENBQUM7Z0JBQ3ZDLElBQUlpQixlQUFlO29CQUNqQixNQUFNWixRQUFRQyxXQUFXVyxhQUFhLENBQUMsRUFBRSxDQUFDVixPQUFPLENBQUMsS0FBSztvQkFDdkQsTUFBTUUsUUFBUUgsV0FBV1csYUFBYSxDQUFDLEVBQUUsQ0FBQ1YsT0FBTyxDQUFDLEtBQUs7b0JBRXZELE9BQU87d0JBQ0wsR0FBRzdCLE9BQU87d0JBQ1ZnQyxjQUFjO3dCQUNkQyxNQUFNO3dCQUNOQyxXQUFXO3dCQUNYUCxPQUFPQTt3QkFDUEYsT0FBT0E7d0JBQ1BVLFdBQVcsQ0FBQyxVQUFVLEVBQUVSLE1BQU1VLE9BQU8sQ0FBQyxHQUFHLENBQUM7d0JBQzFDRCxhQUFhLENBQUMsRUFBRVgsTUFBTSxRQUFRLEVBQUVFLE1BQU1VLE9BQU8sQ0FBQyxHQUFHLFNBQVMsQ0FBQzt3QkFDM0RDLFlBQVk7b0JBQ2Q7Z0JBQ0Y7WUFDRjtRQUNGO1FBRUEsK0RBQStEO1FBQy9ELE1BQU1FLGlCQUFpQnJCLFFBQVFHLEtBQUssQ0FBQztRQUNyQyxJQUFJa0IsZ0JBQWdCO1lBQ2xCLE1BQU1oQixhQUFhZ0IsY0FBYyxDQUFDLEVBQUUsQ0FBQ3BCLElBQUk7WUFDekMsTUFBTUssUUFBUWUsY0FBYyxDQUFDLEVBQUUsQ0FBQ3BCLElBQUk7WUFFcEMsZ0NBQWdDO1lBQ2hDLE1BQU1xQixXQUFXakIsV0FBV0YsS0FBSyxDQUFDO1lBQ2xDLElBQUltQixVQUFVO2dCQUNaLE9BQU87b0JBQ0wsR0FBR3pDLE9BQU87b0JBQ1ZnQyxjQUFjO29CQUNkQyxNQUFNO29CQUNOQyxXQUFXO29CQUNYUSxNQUFNRCxRQUFRLENBQUMsRUFBRSxDQUFDckIsSUFBSTtvQkFDdEJ1QixZQUFZQyxTQUFTSCxRQUFRLENBQUMsRUFBRTtvQkFDaENoQixPQUFPQTtvQkFDUFcsYUFBYSxDQUFDLEVBQUVYLE1BQU0sV0FBVyxFQUFFZ0IsUUFBUSxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUVBLFFBQVEsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDbEU7WUFDRjtZQUVBLHFDQUFxQztZQUNyQyxNQUFNSSxjQUFjckIsV0FBV0YsS0FBSyxDQUFDO1lBQ3JDLElBQUl1QixhQUFhO2dCQUNmLE9BQU87b0JBQ0wsR0FBRzdDLE9BQU87b0JBQ1ZnQyxjQUFjO29CQUNkQyxNQUFNO29CQUNOQyxXQUFXO29CQUNYUSxNQUFNRyxXQUFXLENBQUMsRUFBRSxDQUFDekIsSUFBSTtvQkFDekJ1QixZQUFZQyxTQUFTQyxXQUFXLENBQUMsRUFBRTtvQkFDbkNwQixPQUFPQTtvQkFDUFcsYUFBYSxDQUFDLEVBQUVYLE1BQU0sU0FBUyxFQUFFb0IsV0FBVyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUVBLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDdEU7WUFDRjtRQUNGO1FBRUEseURBQXlEO1FBQ3pELE1BQU1DLGlCQUFpQjtRQUN2QixNQUFNQyxvQkFBb0I7UUFDMUIsTUFBTUMsZUFBZTtRQUVyQixNQUFNUCxXQUFXdEIsUUFBUUcsS0FBSyxDQUFDd0I7UUFDL0IsSUFBSUwsVUFBVTtZQUNaLE9BQU87Z0JBQ0wsR0FBR3pDLE9BQU87Z0JBQ1ZnQyxjQUFjO2dCQUNkQyxNQUFNO2dCQUNOQyxXQUFXO2dCQUNYUSxNQUFNRCxRQUFRLENBQUMsRUFBRSxDQUFDckIsSUFBSTtnQkFDdEJ1QixZQUFZQyxTQUFTSCxRQUFRLENBQUMsRUFBRTtnQkFDaENoQixPQUFPekIsUUFBUUQsTUFBTSxJQUFJO2dCQUN6QnFDLGFBQWEsQ0FBQyxFQUFFcEMsUUFBUUQsTUFBTSxDQUFDLFdBQVcsRUFBRTBDLFFBQVEsQ0FBQyxFQUFFLENBQUMsRUFBRSxFQUFFQSxRQUFRLENBQUMsRUFBRSxDQUFDLENBQUM7WUFDM0U7UUFDRjtRQUVBLE1BQU1JLGNBQWMxQixRQUFRRyxLQUFLLENBQUN5QjtRQUNsQyxJQUFJRixhQUFhO1lBQ2YsT0FBTztnQkFDTCxHQUFHN0MsT0FBTztnQkFDVmdDLGNBQWM7Z0JBQ2RDLE1BQU07Z0JBQ05DLFdBQVc7Z0JBQ1hRLE1BQU1HLFdBQVcsQ0FBQyxFQUFFLENBQUN6QixJQUFJO2dCQUN6QnVCLFlBQVlDLFNBQVNDLFdBQVcsQ0FBQyxFQUFFO2dCQUNuQ3BCLE9BQU96QixRQUFRRCxNQUFNLElBQUk7Z0JBQ3pCcUMsYUFBYSxDQUFDLEVBQUVwQyxRQUFRRCxNQUFNLENBQUMsU0FBUyxFQUFFOEMsV0FBVyxDQUFDLEVBQUUsQ0FBQyxFQUFFLEVBQUVBLFdBQVcsQ0FBQyxFQUFFLENBQUMsQ0FBQztZQUMvRTtRQUNGO1FBRUEsNkVBQTZFO1FBQzdFLElBQUkxQixRQUFROEIsUUFBUSxDQUFDLFlBQVk5QixRQUFROEIsUUFBUSxDQUFDLGtCQUFrQjtZQUNsRSxNQUFNQyxhQUFhL0IsUUFBUUcsS0FBSyxDQUFDO1lBQ2pDLE1BQU02QixhQUFhaEMsUUFBUUcsS0FBSyxDQUFDO1lBRWpDLElBQUk0QixjQUFjQyxZQUFZO2dCQUM1QixNQUFNeEIsUUFBUUMsV0FBV3NCLFVBQVUsQ0FBQyxFQUFFLENBQUNyQixPQUFPLENBQUMsS0FBSztnQkFDcEQsTUFBTXVCLGFBQWFELFVBQVUsQ0FBQyxFQUFFLENBQUMvQixJQUFJO2dCQUVyQyxPQUFPO29CQUNMLEdBQUdwQixPQUFPO29CQUNWZ0MsY0FBYztvQkFDZEMsTUFBTTtvQkFDTkMsV0FBVztvQkFDWFAsT0FBT0E7b0JBQ1BGLE9BQU8yQjtvQkFDUGpCLFdBQVcsQ0FBQyxVQUFVLEVBQUVSLE1BQU1VLE9BQU8sQ0FBQyxHQUFHLENBQUM7b0JBQzFDRCxhQUFhLENBQUMsY0FBYyxDQUFDO2dCQUMvQjtZQUNGO1FBQ0Y7UUFFQSxrR0FBa0c7UUFDbEcsSUFBSWpCLFFBQVE4QixRQUFRLENBQUMsa0JBQWU5QixRQUFROEIsUUFBUSxDQUFDLHNCQUFzQjtZQUN6RSxNQUFNQyxhQUFhL0IsUUFBUUcsS0FBSyxDQUFDO1lBQ2pDLE1BQU0rQixZQUFZbEMsUUFBUUcsS0FBSyxDQUFDO1lBRWhDLElBQUk0QixjQUFjRyxXQUFXO2dCQUMzQixNQUFNMUIsUUFBUUMsV0FBV3NCLFVBQVUsQ0FBQyxFQUFFLENBQUNyQixPQUFPLENBQUMsS0FBSztnQkFDcEQsTUFBTUMsT0FBT3VCLFNBQVMsQ0FBQyxFQUFFLENBQUNqQyxJQUFJO2dCQUU5QiwwRUFBMEU7Z0JBQzFFLE1BQU1rQyxjQUFjeEIsS0FBS1IsS0FBSyxDQUFDO2dCQUMvQixJQUFJZ0MsYUFBYTtvQkFDZixNQUFNQyxnQkFBZ0JELFdBQVcsQ0FBQyxFQUFFLENBQUNsQyxJQUFJO29CQUN6QyxNQUFNdUIsYUFBYVcsV0FBVyxDQUFDLEVBQUU7b0JBRWpDLE9BQU87d0JBQ0wsR0FBR3RELE9BQU87d0JBQ1ZnQyxjQUFjO3dCQUNkQyxNQUFNO3dCQUNOQyxXQUFXO3dCQUNYUCxPQUFPQTt3QkFDUEYsT0FBTzhCO3dCQUNQcEIsV0FBVyxDQUFDLE9BQU8sRUFBRVEsV0FBVyxxQkFBcUIsQ0FBQzt3QkFDdERQLGFBQWEsQ0FBQyxPQUFPLEVBQUVPLFdBQVcseUJBQXlCLENBQUM7b0JBQzlEO2dCQUNGO2dCQUVBLHFDQUFxQztnQkFDckMsT0FBTztvQkFDTCxHQUFHM0MsT0FBTztvQkFDVmdDLGNBQWM7b0JBQ2RDLE1BQU07b0JBQ05DLFdBQVc7b0JBQ1hQLE9BQU9BO29CQUNQRixPQUFPO29CQUNQVSxXQUFXTDtvQkFDWE0sYUFBYSxDQUFDLG1CQUFtQixFQUFFVCxNQUFNVSxPQUFPLENBQUMsR0FBRyxTQUFTLENBQUM7Z0JBQ2hFO1lBQ0Y7UUFDRjtRQUVBLE1BQU1tQixhQUFhckMsUUFBUUcsS0FBSyxDQUFDMEI7UUFDakMsSUFBSVEsY0FBZXJDLENBQUFBLFFBQVFzQyxXQUFXLEdBQUdSLFFBQVEsQ0FBQyxjQUFjOUIsUUFBUXNDLFdBQVcsR0FBR1IsUUFBUSxDQUFDLFlBQVk5QixRQUFRc0MsV0FBVyxHQUFHUixRQUFRLENBQUMsU0FBUSxHQUFJO1lBQ3BKLE1BQU10QixRQUFRQyxXQUFXNEIsVUFBVSxDQUFDLEVBQUUsQ0FBQzNCLE9BQU8sQ0FBQyxLQUFLO1lBQ3BELE9BQU87Z0JBQ0wsR0FBRzdCLE9BQU87Z0JBQ1ZnQyxjQUFjO2dCQUNkQyxNQUFNZCxRQUFRc0MsV0FBVyxHQUFHUixRQUFRLENBQUMsV0FBVyxVQUFVO2dCQUMxRGYsV0FBVztnQkFDWFAsT0FBT0E7Z0JBQ1BGLE9BQU96QixRQUFRRCxNQUFNLElBQUk7Z0JBQ3pCcUMsYUFBYWpCLFFBQVF1QyxTQUFTLENBQUMsR0FBRztZQUNwQztRQUNGO1FBRUEsMEJBQTBCO1FBQzFCLE9BQU87WUFDTCxHQUFHMUQsT0FBTztZQUNWZ0MsY0FBYztZQUNkRSxXQUFXO1lBQ1hFLGFBQWFqQixRQUFRdUMsU0FBUyxDQUFDLEdBQUc7UUFDcEM7SUFFRixFQUFFLE9BQU85RixPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQyxnQkFBZ0JBO1FBQzlCLE9BQU87WUFDTCxHQUFHb0MsT0FBTztZQUNWZ0MsY0FBYztZQUNkRSxXQUFXO1lBQ1hFLGFBQWFwQyxRQUFRbUIsT0FBTyxDQUFDdUMsU0FBUyxDQUFDLEdBQUc7UUFDNUM7SUFDRjtBQUNGO0FBRU8sZUFBZUMsSUFBSW5GLE9BQW9CO0lBQzVDLElBQUk7UUFDRixNQUFNYixXQUFXUjtRQUVqQixrREFBa0Q7UUFDbEQsTUFBTXlHLGlCQUFpQmpHLFNBQVNzQixHQUFHLENBQUNpQztRQUVwQ3JELFFBQVFTLEdBQUcsQ0FBQyxDQUFDLFVBQVUsRUFBRXNGLGVBQWV6RixNQUFNLENBQUMsV0FBVyxFQUFFeUYsZUFBZXZFLE1BQU0sQ0FBQ3dFLENBQUFBLElBQUtBLEVBQUU3QixZQUFZLEVBQUU3RCxNQUFNLENBQUMsb0JBQW9CLENBQUM7UUFFbkksT0FBT2xDLFNBQVNMLHFEQUFZQSxDQUFDOEMsSUFBSSxDQUFDO1lBQ2hDRSxTQUFTO1lBQ1RqQixVQUFVaUc7WUFDVjNELE9BQU8yRCxlQUFlekYsTUFBTTtZQUM1QkosYUFBYUosU0FBU1EsTUFBTSxHQUFHLElBQUlSLFFBQVEsQ0FBQyxFQUFFLEVBQUU2QixZQUFZO1lBQzVEc0UsUUFBUUYsZUFBZXZFLE1BQU0sQ0FBQ3dFLENBQUFBLElBQUtBLEVBQUU3QixZQUFZLEVBQUU3RCxNQUFNO1FBQzNEO0lBRUYsRUFBRSxPQUFPUCxPQUFPO1FBQ2RDLFFBQVFELEtBQUssQ0FBQywyQkFBMkJBO1FBQ3pDLE9BQU8zQixTQUFTTCxxREFBWUEsQ0FBQzhDLElBQUksQ0FDL0I7WUFBRUUsU0FBUztZQUFPaEIsT0FBTztRQUEwQixHQUNuRDtZQUFFaUIsUUFBUTtRQUFJO0lBRWxCO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9yZWRtLWRhc2hib2FyZC8uL2FwcC9hcGkvd2ViaG9vay9jaGFubmVsLW1lc3NhZ2VzL3JvdXRlLnRzPzNiODUiXSwic291cmNlc0NvbnRlbnQiOlsiIGltcG9ydCB7IE5leHRSZXF1ZXN0LCBOZXh0UmVzcG9uc2UgfSBmcm9tICduZXh0L3NlcnZlcic7XHJcbmltcG9ydCBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xyXG5pbXBvcnQgeyBub3RpZnlDbGllbnRzIH0gZnJvbSAnLi4vc3NlL3JvdXRlJztcclxuXHJcbmludGVyZmFjZSBNZXNzYWdlRGF0YSB7XHJcbiAgaWQ6IHN0cmluZztcclxuICB0aW1lc3RhbXA6IHN0cmluZztcclxuICBkaXNjb3JkVGltZXN0YW1wPzogc3RyaW5nO1xyXG4gIGF1dGhvcjogc3RyaW5nO1xyXG4gIGNvbnRlbnQ6IHN0cmluZztcclxuICBjaGFubmVsSWQ6IHN0cmluZztcclxuICBzb3VyY2U6IHN0cmluZztcclxufVxyXG5cclxuaW50ZXJmYWNlIFdlYmhvb2tQYXlsb2FkIHtcclxuICBjaGFubmVsSWQ6IHN0cmluZztcclxuICBtZXNzYWdlczogTWVzc2FnZURhdGFbXTtcclxufVxyXG5cclxuLy8gQ09SUyBoZWFkZXJzXHJcbmNvbnN0IGNvcnNIZWFkZXJzID0ge1xyXG4gICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiAnKicsXHJcbiAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnR0VULCBQT1NULCBPUFRJT05TJyxcclxuICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIE9yaWdpbiwgQWNjZXB0JyxcclxuICAnQWNjZXNzLUNvbnRyb2wtTWF4LUFnZSc6ICc4NjQwMCcsXHJcbn07XHJcblxyXG5mdW5jdGlvbiB3aXRoQ29ycyhyZXNwb25zZTogUmVzcG9uc2UpIHtcclxuICBPYmplY3QuZW50cmllcyhjb3JzSGVhZGVycykuZm9yRWFjaCgoW2tleSwgdmFsdWVdKSA9PiB7XHJcbiAgICByZXNwb25zZS5oZWFkZXJzLnNldChrZXksIHZhbHVlKTtcclxuICB9KTtcclxuICByZXR1cm4gcmVzcG9uc2U7XHJcbn1cclxuXHJcbi8vIFN0b3JlIG1lc3NhZ2VzIGluIGEgSlNPTiBmaWxlIGluIHRoZSBwdWJsaWMgZGlyZWN0b3J5XHJcbmNvbnN0IE1FU1NBR0VTX0ZJTEUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICdkaXNjb3JkLW1lc3NhZ2VzLmpzb24nKTtcclxuXHJcbi8vIEVuc3VyZSB0aGUgcHVibGljIGRpcmVjdG9yeSBleGlzdHNcclxuZnVuY3Rpb24gZW5zdXJlUHVibGljRGlyZWN0b3J5KCkge1xyXG4gIGNvbnN0IHB1YmxpY0RpciA9IHBhdGguam9pbihwcm9jZXNzLmN3ZCgpLCAncHVibGljJyk7XHJcbiAgaWYgKCFmcy5leGlzdHNTeW5jKHB1YmxpY0RpcikpIHtcclxuICAgIGZzLm1rZGlyU3luYyhwdWJsaWNEaXIsIHsgcmVjdXJzaXZlOiB0cnVlIH0pO1xyXG4gIH1cclxufVxyXG5cclxuLy8gUmVhZCBleGlzdGluZyBtZXNzYWdlcyBmcm9tIGZpbGVcclxuZnVuY3Rpb24gcmVhZE1lc3NhZ2VzKCk6IE1lc3NhZ2VEYXRhW10ge1xyXG4gIHRyeSB7XHJcbiAgICBlbnN1cmVQdWJsaWNEaXJlY3RvcnkoKTtcclxuICAgIFxyXG4gICAgaWYgKCFmcy5leGlzdHNTeW5jKE1FU1NBR0VTX0ZJTEUpKSB7XHJcbiAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgZmlsZUNvbnRlbnQgPSBmcy5yZWFkRmlsZVN5bmMoTUVTU0FHRVNfRklMRSwgJ3V0Zi04Jyk7XHJcbiAgICBjb25zdCBkYXRhID0gSlNPTi5wYXJzZShmaWxlQ29udGVudCk7XHJcbiAgICByZXR1cm4gQXJyYXkuaXNBcnJheShkYXRhLm1lc3NhZ2VzKSA/IGRhdGEubWVzc2FnZXMgOiBbXTtcclxuICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgY29uc29sZS5lcnJvcignRXJyb3IgcmVhZGluZyBtZXNzYWdlcyBmaWxlOicsIGVycm9yKTtcclxuICAgIHJldHVybiBbXTtcclxuICB9XHJcbn1cclxuXHJcbi8vIFdyaXRlIG1lc3NhZ2VzIHRvIGZpbGVcclxuZnVuY3Rpb24gd3JpdGVNZXNzYWdlcyhtZXNzYWdlczogTWVzc2FnZURhdGFbXSkge1xyXG4gIHRyeSB7XHJcbiAgICBlbnN1cmVQdWJsaWNEaXJlY3RvcnkoKTtcclxuICAgIFxyXG4gICAgY29uc3QgZGF0YSA9IHtcclxuICAgICAgbGFzdFVwZGF0ZWQ6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgdG90YWxNZXNzYWdlczogbWVzc2FnZXMubGVuZ3RoLFxyXG4gICAgICBtZXNzYWdlczogbWVzc2FnZXNcclxuICAgIH07XHJcbiAgICBcclxuICAgIGZzLndyaXRlRmlsZVN5bmMoTUVTU0FHRVNfRklMRSwgSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMikpO1xyXG4gICAgY29uc29sZS5sb2coYOKchSBTYXZlZCAke21lc3NhZ2VzLmxlbmd0aH0gbWVzc2FnZXMgdG8gZGlzY29yZC1tZXNzYWdlcy5qc29uYCk7XHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHdyaXRpbmcgbWVzc2FnZXMgZmlsZTonLCBlcnJvcik7XHJcbiAgICB0aHJvdyBlcnJvcjtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGJvZHk6IFdlYmhvb2tQYXlsb2FkID0gYXdhaXQgcmVxdWVzdC5qc29uKCk7XHJcbiAgICBcclxuICAgIGlmICghYm9keS5jaGFubmVsSWQgfHwgIUFycmF5LmlzQXJyYXkoYm9keS5tZXNzYWdlcykpIHtcclxuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnSW52YWxpZCBwYXlsb2FkIGZvcm1hdCcgfSxcclxuICAgICAgICB7IHN0YXR1czogNDAwIH1cclxuICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBSZWFkIGV4aXN0aW5nIG1lc3NhZ2VzXHJcbiAgICBjb25zdCBleGlzdGluZ01lc3NhZ2VzID0gcmVhZE1lc3NhZ2VzKCk7XHJcbiAgICBjb25zdCBleGlzdGluZ0lkcyA9IG5ldyBTZXQoZXhpc3RpbmdNZXNzYWdlcy5tYXAobXNnID0+IG1zZy5pZCkpO1xyXG5cclxuICAgIC8vIFNpbXBsZSBkZWR1cGxpY2F0aW9uIGJhc2VkIG9ubHkgb24gbWVzc2FnZSBJRCBhbmQgdGltZXN0YW1wXHJcbiAgICBjb25zdCBuZXdNZXNzYWdlcyA9IGJvZHkubWVzc2FnZXMuZmlsdGVyKG1zZyA9PiB7XHJcbiAgICAgIC8vIE9ubHkgY2hlY2sgaWYgd2UndmUgc2VlbiB0aGlzIGV4YWN0IG1lc3NhZ2UgSUQgYmVmb3JlXHJcbiAgICAgIGlmIChleGlzdGluZ0lkcy5oYXMobXNnLmlkKSkge1xyXG4gICAgICAgIHJldHVybiBmYWxzZTtcclxuICAgICAgfVxyXG4gICAgICBcclxuICAgICAgLy8gQWxzbyBjaGVjayBmb3Igc2FtZSB0aW1lc3RhbXAgdG8gY2F0Y2ggcmFwaWQgZHVwbGljYXRlc1xyXG4gICAgICBjb25zdCBtc2dUaW1lc3RhbXAgPSBuZXcgRGF0ZShtc2cudGltZXN0YW1wKS5nZXRUaW1lKCk7XHJcbiAgICAgIGNvbnN0IGR1cGxpY2F0ZUJ5VGltZSA9IGV4aXN0aW5nTWVzc2FnZXMuc29tZShleGlzdGluZyA9PiBcclxuICAgICAgICBNYXRoLmFicyhuZXcgRGF0ZShleGlzdGluZy50aW1lc3RhbXApLmdldFRpbWUoKSAtIG1zZ1RpbWVzdGFtcCkgPCAxMDAwIC8vIFdpdGhpbiAxIHNlY29uZFxyXG4gICAgICAgICYmIGV4aXN0aW5nLmF1dGhvciA9PT0gbXNnLmF1dGhvclxyXG4gICAgICApO1xyXG4gICAgICBcclxuICAgICAgcmV0dXJuICFkdXBsaWNhdGVCeVRpbWU7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgaWYgKG5ld01lc3NhZ2VzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xyXG4gICAgICAgIHN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgbWVzc2FnZTogJ05vIG5ldyBtZXNzYWdlcyB0byBwcm9jZXNzJyxcclxuICAgICAgICB0b3RhbDogZXhpc3RpbmdNZXNzYWdlcy5sZW5ndGhcclxuICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTWVyZ2Ugd2l0aCBleGlzdGluZyBtZXNzYWdlc1xyXG4gICAgY29uc3QgYWxsTWVzc2FnZXMgPSBbLi4uZXhpc3RpbmdNZXNzYWdlcywgLi4ubmV3TWVzc2FnZXNdO1xyXG4gICAgXHJcbiAgICAvLyBLZWVwIG9ubHkgdGhlIG1vc3QgcmVjZW50IDEwMDAgbWVzc2FnZXMgdG8gcHJldmVudCBmaWxlIGZyb20gZ3Jvd2luZyB0b28gbGFyZ2VcclxuICAgIGNvbnN0IHJlY2VudE1lc3NhZ2VzID0gYWxsTWVzc2FnZXNcclxuICAgICAgLnNvcnQoKGEsIGIpID0+IG5ldyBEYXRlKGIudGltZXN0YW1wKS5nZXRUaW1lKCkgLSBuZXcgRGF0ZShhLnRpbWVzdGFtcCkuZ2V0VGltZSgpKVxyXG4gICAgICAuc2xpY2UoMCwgMTAwMCk7XHJcblxyXG4gICAgLy8gV3JpdGUgdG8gZmlsZVxyXG4gICAgd3JpdGVNZXNzYWdlcyhyZWNlbnRNZXNzYWdlcyk7XHJcblxyXG4gICAgY29uc29sZS5sb2coYPCfk50gUHJvY2Vzc2VkICR7bmV3TWVzc2FnZXMubGVuZ3RofSBuZXcgbWVzc2FnZXMgZnJvbSBjaGFubmVsICR7Ym9keS5jaGFubmVsSWR9YCk7XHJcblxyXG4gICAgLy8gQ3JlYXRlIGEgc2ltcGxlIG5vdGlmaWNhdGlvbiBtZWNoYW5pc20gdXNpbmcgYSB0aW1lc3RhbXAgZmlsZVxyXG4gICAgLy8gVGhpcyB3aWxsIGFsbG93IHRoZSBmcm9udGVuZCB0byBkZXRlY3Qgd2hlbiBuZXcgZGF0YSBpcyBhdmFpbGFibGVcclxuICAgIGNvbnN0IG5vdGlmaWNhdGlvbkZpbGUgPSBwYXRoLmpvaW4ocHJvY2Vzcy5jd2QoKSwgJ3B1YmxpYycsICdsYXN0LXVwZGF0ZS5qc29uJyk7XHJcbiAgICB0cnkge1xyXG4gICAgICBjb25zdCB1cGRhdGVJbmZvID0ge1xyXG4gICAgICAgIGxhc3RVcGRhdGU6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSxcclxuICAgICAgICBuZXdNZXNzYWdlczogbmV3TWVzc2FnZXMubGVuZ3RoLFxyXG4gICAgICAgIHRvdGFsTWVzc2FnZXM6IHJlY2VudE1lc3NhZ2VzLmxlbmd0aCxcclxuICAgICAgICB0aW1lc3RhbXA6IERhdGUubm93KCkgLy8gQWRkIHRpbWVzdGFtcCBmb3IgZWFzaWVyIGNvbXBhcmlzb25cclxuICAgICAgfTtcclxuICAgICAgZnMud3JpdGVGaWxlU3luYyhub3RpZmljYXRpb25GaWxlLCBKU09OLnN0cmluZ2lmeSh1cGRhdGVJbmZvKSk7XHJcbiAgICAgIGNvbnNvbGUubG9nKCfwn5OhIENyZWF0ZWQgdXBkYXRlIG5vdGlmaWNhdGlvbiBmb3IgZnJvbnRlbmQnKTtcclxuICAgICAgXHJcbiAgICAgIC8vIE5PVElGWSBTU0UgQ0xJRU5UUyBJTU1FRElBVEVMWVxyXG4gICAgICB0cnkge1xyXG4gICAgICAgIG5vdGlmeUNsaWVudHMoe1xyXG4gICAgICAgICAgdHlwZTogJ25ldy1tZXNzYWdlcycsXHJcbiAgICAgICAgICBjb3VudDogbmV3TWVzc2FnZXMubGVuZ3RoLFxyXG4gICAgICAgICAgdG90YWw6IHJlY2VudE1lc3NhZ2VzLmxlbmd0aCxcclxuICAgICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY29uc29sZS5sb2coYPCfmoAgTm90aWZpZWQgU1NFIGNsaWVudHMgb2YgJHtuZXdNZXNzYWdlcy5sZW5ndGh9IG5ldyBtZXNzYWdlc2ApO1xyXG4gICAgICB9IGNhdGNoIChzc2VFcnJvcikge1xyXG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBub3RpZnkgU1NFIGNsaWVudHM6Jywgc3NlRXJyb3IpO1xyXG4gICAgICB9XHJcbiAgICB9IGNhdGNoIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLndhcm4oJ0NvdWxkIG5vdCB3cml0ZSBub3RpZmljYXRpb24gZmlsZTonLCBlcnJvcik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHdpdGhDb3JzKE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZTogYFByb2Nlc3NlZCAke25ld01lc3NhZ2VzLmxlbmd0aH0gbmV3IG1lc3NhZ2VzYCxcclxuICAgICAgbmV3TWVzc2FnZXM6IG5ld01lc3NhZ2VzLmxlbmd0aCxcclxuICAgICAgdG90YWw6IHJlY2VudE1lc3NhZ2VzLmxlbmd0aCxcclxuICAgICAgbGFzdFVwZGF0ZTogbmV3IERhdGUoKS50b0lTT1N0cmluZygpXHJcbiAgICB9KSk7XHJcblxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBwcm9jZXNzaW5nIHdlYmhvb2s6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSxcclxuICAgICAgeyBzdGF0dXM6IDUwMCB9XHJcbiAgICApKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBPUFRJT05TKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XHJcbiAgcmV0dXJuIHdpdGhDb3JzKG5ldyBSZXNwb25zZShudWxsLCB7IHN0YXR1czogMjAwIH0pKTtcclxufVxyXG5cclxuLy8gRGlzY29yZCBtZXNzYWdlIHBhcnNlciAtIGNvbnZlcnRzIHJhdyBtZXNzYWdlcyB0byBhY3Rpdml0eSBkYXRhXHJcbmZ1bmN0aW9uIHBhcnNlRGlzY29yZE1lc3NhZ2UobWVzc2FnZTogTWVzc2FnZURhdGEpOiBhbnkge1xyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBjb250ZW50ID0gbWVzc2FnZS5jb250ZW50LnRyaW0oKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLyBQYXJzZSBTcGlkZXkgQm90IG1lc3NhZ2VzIGZvciBmYXJtIGFjdGl2aXRpZXNcclxuICAgIC8vIFRyeSBDQUlYQSBtZXNzYWdlcyBmaXJzdCAoZGVwb3NpdHMvd2l0aGRyYXdhbHMpIC0gdGhleSBkb24ndCBoYXZlIFwiQXV0b3I6XCIgZmllbGRcclxuICAgIGNvbnN0IGNhaXhhTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9SRUdJU1RSTyAtIGZhemVuZGFfODZcXHMqQ0FJWEEgT1JHQU5JWkHDh8ODT1xccyotXFxzKihERVDDk1NJVE98U0FRVUUpKC4rPylBdXRvcjooLis/KVxccypcXHxcXHMqRklYTzpcXHMqKFxcZCspL3MpO1xyXG4gICAgaWYgKGNhaXhhTWF0Y2gpIHtcclxuICAgICAgY29uc3QgdHJhbnNhY3Rpb25UeXBlID0gY2FpeGFNYXRjaFsxXS50cmltKCk7XHJcbiAgICAgIGNvbnN0IGFjdGlvblBhcnQgPSBjYWl4YU1hdGNoWzJdLnRyaW0oKTtcclxuICAgICAgY29uc3QgYXV0b3IgPSBjYWl4YU1hdGNoWzNdLnRyaW0oKTtcclxuICAgICAgXHJcbiAgICAgIGlmICh0cmFuc2FjdGlvblR5cGUgPT09ICdERVDDk1NJVE8nKSB7XHJcbiAgICAgICAgLy8gUGFyc2UgREVQw5NTSVRPIChkZXBvc2l0IG1vbmV5KSAtIHdpdGggXCJBw6fDo286XCIgKGZvciBzYWxlcy9hY3Rpb25zKVxyXG4gICAgICAgIGNvbnN0IGRlcG9zaXRXaXRoQWN0aW9uTWF0Y2ggPSBhY3Rpb25QYXJ0Lm1hdGNoKC9WYWxvciBkZXBvc2l0YWRvOlxccypcXCQoWzAtOSwuXSspXFxzKkHDp8OjbzooLis/KVNhbGRvIGFww7NzIGRlcMOzc2l0bzpcXHMqXFwkKFswLTksLl0rKS8pO1xyXG4gICAgICAgIGlmIChkZXBvc2l0V2l0aEFjdGlvbk1hdGNoKSB7XHJcbiAgICAgICAgICBjb25zdCB2YWxvciA9IHBhcnNlRmxvYXQoZGVwb3NpdFdpdGhBY3Rpb25NYXRjaFsxXS5yZXBsYWNlKCcsJywgJycpKTtcclxuICAgICAgICAgIGNvbnN0IGFjYW8gPSBkZXBvc2l0V2l0aEFjdGlvbk1hdGNoWzJdLnRyaW0oKTtcclxuICAgICAgICAgIGNvbnN0IHNhbGRvID0gcGFyc2VGbG9hdChkZXBvc2l0V2l0aEFjdGlvbk1hdGNoWzNdLnJlcGxhY2UoJywnLCAnJykpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgICAgICBwYXJzZVN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRpcG86ICd2ZW5kYScsXHJcbiAgICAgICAgICAgIGNhdGVnb3JpYTogJ2ZpbmFuY2Vpcm8nLFxyXG4gICAgICAgICAgICB2YWxvcjogdmFsb3IsXHJcbiAgICAgICAgICAgIGF1dG9yOiBhdXRvcixcclxuICAgICAgICAgICAgZGVzY3JpY2FvOiBhY2FvLFxyXG4gICAgICAgICAgICBkaXNwbGF5VGV4dDogYCR7YXV0b3J9ICR7YWNhb30gcG9yICQke3ZhbG9yLnRvRml4ZWQoMil9YCxcclxuICAgICAgICAgICAgY29uZmlkZW5jZTogJ2hpZ2gnXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfSBlbHNlIGlmICh0cmFuc2FjdGlvblR5cGUgPT09ICdTQVFVRScpIHtcclxuICAgICAgICAvLyBQYXJzZSBTQVFVRSAod2l0aGRyYXcgbW9uZXkpXHJcbiAgICAgICAgY29uc3Qgd2l0aGRyYXdNYXRjaCA9IGFjdGlvblBhcnQubWF0Y2goL1ZhbG9yIHNhY2FkbzpcXHMqXFwkKFswLTksLl0rKS4qP1NhbGRvIGFww7NzIHNhcXVlOlxccypcXCQoWzAtOSwuXSspL3MpO1xyXG4gICAgICAgIGlmICh3aXRoZHJhd01hdGNoKSB7XHJcbiAgICAgICAgICBjb25zdCB2YWxvciA9IHBhcnNlRmxvYXQod2l0aGRyYXdNYXRjaFsxXS5yZXBsYWNlKCcsJywgJycpKTtcclxuICAgICAgICAgIGNvbnN0IHNhbGRvID0gcGFyc2VGbG9hdCh3aXRoZHJhd01hdGNoWzNdLnJlcGxhY2UoJywnLCAnJykpO1xyXG4gICAgICAgICAgXHJcbiAgICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgICAgICBwYXJzZVN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICAgIHRpcG86ICdzYXF1ZScsXHJcbiAgICAgICAgICAgIGNhdGVnb3JpYTogJ2ZpbmFuY2Vpcm8nLFxyXG4gICAgICAgICAgICB2YWxvcjogdmFsb3IsXHJcbiAgICAgICAgICAgIGF1dG9yOiBhdXRvcixcclxuICAgICAgICAgICAgZGVzY3JpY2FvOiBgU2FxdWUgZGUgJCR7dmFsb3IudG9GaXhlZCgyKX1gLFxyXG4gICAgICAgICAgICBkaXNwbGF5VGV4dDogYCR7YXV0b3J9IHNhY291ICQke3ZhbG9yLnRvRml4ZWQoMil9IGRvIGNhaXhhYCxcclxuICAgICAgICAgICAgY29uZmlkZW5jZTogJ2hpZ2gnXHJcbiAgICAgICAgICB9O1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBUaGVuIHRyeSBCQcOaIG1lc3NhZ2VzIChpbnZlbnRvcnkpIC0gdGhleSBoYXZlIFwiQXV0b3I6XCIgZmllbGRcclxuICAgIGNvbnN0IHNwaWRleUJvdE1hdGNoID0gY29udGVudC5tYXRjaCgvUkVHSVNUUk8gLSBmYXplbmRhXzg2KC4rPylBdXRvcjooLis/KVxccypcXHxcXHMqRklYTzpcXHMqKFxcZCspL3MpO1xyXG4gICAgaWYgKHNwaWRleUJvdE1hdGNoKSB7XHJcbiAgICAgIGNvbnN0IGFjdGlvblBhcnQgPSBzcGlkZXlCb3RNYXRjaFsxXS50cmltKCk7XHJcbiAgICAgIGNvbnN0IGF1dG9yID0gc3BpZGV5Qm90TWF0Y2hbMl0udHJpbSgpO1xyXG4gICAgICBcclxuICAgICAgLy8gUGFyc2UgSU5TRVJJUiBJVEVNIChhZGQgaXRlbSlcclxuICAgICAgY29uc3QgYWRkTWF0Y2ggPSBhY3Rpb25QYXJ0Lm1hdGNoKC9JTlNFUklSIElURU1cXHMqSXRlbSBhZGljaW9uYWRvOlxccyooLis/KVxccyp4KFxcZCspLyk7XHJcbiAgICAgIGlmIChhZGRNYXRjaCkge1xyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgICAgcGFyc2VTdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgdGlwbzogJ2FkaWNpb25hcicsXHJcbiAgICAgICAgICBjYXRlZ29yaWE6ICdpbnZlbnRhcmlvJyxcclxuICAgICAgICAgIGl0ZW06IGFkZE1hdGNoWzFdLnRyaW0oKSxcclxuICAgICAgICAgIHF1YW50aWRhZGU6IHBhcnNlSW50KGFkZE1hdGNoWzJdKSxcclxuICAgICAgICAgIGF1dG9yOiBhdXRvcixcclxuICAgICAgICAgIGRpc3BsYXlUZXh0OiBgJHthdXRvcn0gYWRpY2lvbm91ICR7YWRkTWF0Y2hbMl19eCAke2FkZE1hdGNoWzFdfWBcclxuICAgICAgICB9O1xyXG4gICAgICB9XHJcbiAgICAgIFxyXG4gICAgICAvLyBQYXJzZSBSRU1PVkVSIElURU0gKHJlbW92ZSBpdGVtKSAgXHJcbiAgICAgIGNvbnN0IHJlbW92ZU1hdGNoID0gYWN0aW9uUGFydC5tYXRjaCgvUkVNT1ZFUiBJVEVNXFxzKkl0ZW0gcmVtb3ZpZG86XFxzKiguKz8pXFxzKngoXFxkKykvKTtcclxuICAgICAgaWYgKHJlbW92ZU1hdGNoKSB7XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgIC4uLm1lc3NhZ2UsXHJcbiAgICAgICAgICBwYXJzZVN1Y2Nlc3M6IHRydWUsXHJcbiAgICAgICAgICB0aXBvOiAncmVtb3ZlcicsXHJcbiAgICAgICAgICBjYXRlZ29yaWE6ICdpbnZlbnRhcmlvJyxcclxuICAgICAgICAgIGl0ZW06IHJlbW92ZU1hdGNoWzFdLnRyaW0oKSxcclxuICAgICAgICAgIHF1YW50aWRhZGU6IHBhcnNlSW50KHJlbW92ZU1hdGNoWzJdKSxcclxuICAgICAgICAgIGF1dG9yOiBhdXRvcixcclxuICAgICAgICAgIGRpc3BsYXlUZXh0OiBgJHthdXRvcn0gcmVtb3ZldSAke3JlbW92ZU1hdGNoWzJdfXggJHtyZW1vdmVNYXRjaFsxXX1gXHJcbiAgICAgICAgfTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICAvLyBUcnkgdG8gcGFyc2Ugb3RoZXIgbWVzc2FnZSBmb3JtYXRzIChmYWxsYmFjayBwYXR0ZXJucylcclxuICAgIGNvbnN0IGl0ZW1BZGRQYXR0ZXJuID0gLyg/Okl0ZW0gYWRpY2lvbmFkb3xhZGljaW9ub3UpOlxccyooLis/KVxccyp4KFxcZCspL2k7XHJcbiAgICBjb25zdCBpdGVtUmVtb3ZlUGF0dGVybiA9IC8oPzpJdGVtIHJlbW92aWRvfHJlbW92ZXUpOlxccyooLis/KVxccyp4KFxcZCspL2k7XHJcbiAgICBjb25zdCBtb25leVBhdHRlcm4gPSAvXFwkKFswLTksLl0rKS87XHJcbiAgICBcclxuICAgIGNvbnN0IGFkZE1hdGNoID0gY29udGVudC5tYXRjaChpdGVtQWRkUGF0dGVybik7XHJcbiAgICBpZiAoYWRkTWF0Y2gpIHtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgIHBhcnNlU3VjY2VzczogdHJ1ZSxcclxuICAgICAgICB0aXBvOiAnYWRpY2lvbmFyJyxcclxuICAgICAgICBjYXRlZ29yaWE6ICdpbnZlbnRhcmlvJyxcclxuICAgICAgICBpdGVtOiBhZGRNYXRjaFsxXS50cmltKCksXHJcbiAgICAgICAgcXVhbnRpZGFkZTogcGFyc2VJbnQoYWRkTWF0Y2hbMl0pLFxyXG4gICAgICAgIGF1dG9yOiBtZXNzYWdlLmF1dGhvciB8fCAnU2lzdGVtYScsXHJcbiAgICAgICAgZGlzcGxheVRleHQ6IGAke21lc3NhZ2UuYXV0aG9yfSBhZGljaW9ub3UgJHthZGRNYXRjaFsyXX14ICR7YWRkTWF0Y2hbMV19YCxcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmVtb3ZlTWF0Y2ggPSBjb250ZW50Lm1hdGNoKGl0ZW1SZW1vdmVQYXR0ZXJuKTtcclxuICAgIGlmIChyZW1vdmVNYXRjaCkge1xyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIC4uLm1lc3NhZ2UsXHJcbiAgICAgICAgcGFyc2VTdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgIHRpcG86ICdyZW1vdmVyJyxcclxuICAgICAgICBjYXRlZ29yaWE6ICdpbnZlbnRhcmlvJyxcclxuICAgICAgICBpdGVtOiByZW1vdmVNYXRjaFsxXS50cmltKCksXHJcbiAgICAgICAgcXVhbnRpZGFkZTogcGFyc2VJbnQocmVtb3ZlTWF0Y2hbMl0pLFxyXG4gICAgICAgIGF1dG9yOiBtZXNzYWdlLmF1dGhvciB8fCAnU2lzdGVtYScsXHJcbiAgICAgICAgZGlzcGxheVRleHQ6IGAke21lc3NhZ2UuYXV0aG9yfSByZW1vdmV1ICR7cmVtb3ZlTWF0Y2hbMl19eCAke3JlbW92ZU1hdGNoWzFdfWAsXHJcbiAgICAgIH07XHJcbiAgICB9XHJcbiAgICBcclxuICAgIC8vIFBhcnNlIFNBUVVFICh3aXRoZHJhd2FsKSBtZXNzYWdlcyAtIGZvcm1hdDogWmVybyBCYWxhIHNhY291ICQyMDAwIGRvIGNhaXhhXHJcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnU0FRVUUnKSAmJiBjb250ZW50LmluY2x1ZGVzKCdWYWxvciBzYWNhZG86JykpIHtcclxuICAgICAgY29uc3QgdmFsb3JNYXRjaCA9IGNvbnRlbnQubWF0Y2goL1ZhbG9yIHNhY2FkbzpcXHMqXFwkKFswLTksLl0rKS8pO1xyXG4gICAgICBjb25zdCBhdXRvck1hdGNoID0gY29udGVudC5tYXRjaCgvQXV0b3I6KC4rPylcXHMqXFx8Lyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodmFsb3JNYXRjaCAmJiBhdXRvck1hdGNoKSB7XHJcbiAgICAgICAgY29uc3QgdmFsb3IgPSBwYXJzZUZsb2F0KHZhbG9yTWF0Y2hbMV0ucmVwbGFjZSgnLCcsICcnKSk7XHJcbiAgICAgICAgY29uc3QgYXV0b3JTYXF1ZSA9IGF1dG9yTWF0Y2hbMV0udHJpbSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgICAgcGFyc2VTdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgdGlwbzogJ3NhcXVlJyxcclxuICAgICAgICAgIGNhdGVnb3JpYTogJ2ZpbmFuY2Vpcm8nLFxyXG4gICAgICAgICAgdmFsb3I6IHZhbG9yLFxyXG4gICAgICAgICAgYXV0b3I6IGF1dG9yU2FxdWUsXHJcbiAgICAgICAgICBkZXNjcmljYW86IGBTYXF1ZSBkZSAkJHt2YWxvci50b0ZpeGVkKDIpfWAsXHJcbiAgICAgICAgICBkaXNwbGF5VGV4dDogYHNhY291IGRvIGNhaXhhYFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUGFyc2UgREVQw5NTSVRPIChkZXBvc2l0KSBtZXNzYWdlcyAtIGZvcm1hdDogamFjayBzcGFycm93IHZlbmRldSA0IGFuaW1haXMgbm8gbWF0YWRvdXJvIHBvciAkMTYwXHJcbiAgICBpZiAoY29udGVudC5pbmNsdWRlcygnREVQw5NTSVRPJykgJiYgY29udGVudC5pbmNsdWRlcygnVmFsb3IgZGVwb3NpdGFkbzonKSkge1xyXG4gICAgICBjb25zdCB2YWxvck1hdGNoID0gY29udGVudC5tYXRjaCgvVmFsb3IgZGVwb3NpdGFkbzpcXHMqXFwkKFswLTksLl0rKS8pO1xyXG4gICAgICBjb25zdCBhY2FvTWF0Y2ggPSBjb250ZW50Lm1hdGNoKC9Bw6fDo286KC4rPylTYWxkbyBhcMOzcyBkZXDDs3NpdG86Lyk7XHJcbiAgICAgIFxyXG4gICAgICBpZiAodmFsb3JNYXRjaCAmJiBhY2FvTWF0Y2gpIHtcclxuICAgICAgICBjb25zdCB2YWxvciA9IHBhcnNlRmxvYXQodmFsb3JNYXRjaFsxXS5yZXBsYWNlKCcsJywgJycpKTtcclxuICAgICAgICBjb25zdCBhY2FvID0gYWNhb01hdGNoWzFdLnRyaW0oKTtcclxuICAgICAgICBcclxuICAgICAgICAvLyBFeHRyYWN0IGF1dGhvciBmcm9tIGFjdGlvbiBcImphY2sgc3BhcnJvdyB2ZW5kZXUgNCBhbmltYWlzIG5vIG1hdGFkb3Vyb1wiXHJcbiAgICAgICAgY29uc3QgdmVuZGV1TWF0Y2ggPSBhY2FvLm1hdGNoKC9eKC4rPylcXHMrdmVuZGV1XFxzKyhcXGQrKVxccythbmltYWlzXFxzK25vXFxzK21hdGFkb3Vyby8pO1xyXG4gICAgICAgIGlmICh2ZW5kZXVNYXRjaCkge1xyXG4gICAgICAgICAgY29uc3QgYXV0b3JEZXBvc2l0byA9IHZlbmRldU1hdGNoWzFdLnRyaW0oKTtcclxuICAgICAgICAgIGNvbnN0IHF1YW50aWRhZGUgPSB2ZW5kZXVNYXRjaFsyXTtcclxuICAgICAgICAgIFxyXG4gICAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgLi4ubWVzc2FnZSxcclxuICAgICAgICAgICAgcGFyc2VTdWNjZXNzOiB0cnVlLFxyXG4gICAgICAgICAgICB0aXBvOiAnZGVwb3NpdG8nLFxyXG4gICAgICAgICAgICBjYXRlZ29yaWE6ICdmaW5hbmNlaXJvJyxcclxuICAgICAgICAgICAgdmFsb3I6IHZhbG9yLFxyXG4gICAgICAgICAgICBhdXRvcjogYXV0b3JEZXBvc2l0byxcclxuICAgICAgICAgICAgZGVzY3JpY2FvOiBgVmVuZGV1ICR7cXVhbnRpZGFkZX0gYW5pbWFpcyBubyBtYXRhZG91cm9gLFxyXG4gICAgICAgICAgICBkaXNwbGF5VGV4dDogYHZlbmRldSAke3F1YW50aWRhZGV9IGFuaW1haXMgbm8gbWF0YWRvdXJvIHBvcmBcclxuICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFxyXG4gICAgICAgIC8vIEZhbGxiYWNrIGZvciBvdGhlciBkZXBvc2l0IGFjdGlvbnNcclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgLi4ubWVzc2FnZSxcclxuICAgICAgICAgIHBhcnNlU3VjY2VzczogdHJ1ZSxcclxuICAgICAgICAgIHRpcG86ICdkZXBvc2l0bycsXHJcbiAgICAgICAgICBjYXRlZ29yaWE6ICdmaW5hbmNlaXJvJyxcclxuICAgICAgICAgIHZhbG9yOiB2YWxvcixcclxuICAgICAgICAgIGF1dG9yOiAnU2lzdGVtYScsXHJcbiAgICAgICAgICBkZXNjcmljYW86IGFjYW8sXHJcbiAgICAgICAgICBkaXNwbGF5VGV4dDogYFNpc3RlbWEgZGVwb3NpdG91ICQke3ZhbG9yLnRvRml4ZWQoMil9IG5vIGNhaXhhYFxyXG4gICAgICAgIH07XHJcbiAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBjb25zdCBtb25leU1hdGNoID0gY29udGVudC5tYXRjaChtb25leVBhdHRlcm4pO1xyXG4gICAgaWYgKG1vbmV5TWF0Y2ggJiYgKGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnZGVwb3NpdCcpIHx8IGNvbnRlbnQudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygnc2FxdWUnKSB8fCBjb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3ZlbmRldScpKSkge1xyXG4gICAgICBjb25zdCB2YWxvciA9IHBhcnNlRmxvYXQobW9uZXlNYXRjaFsxXS5yZXBsYWNlKCcsJywgJycpKTtcclxuICAgICAgcmV0dXJuIHtcclxuICAgICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICAgIHBhcnNlU3VjY2VzczogdHJ1ZSxcclxuICAgICAgICB0aXBvOiBjb250ZW50LnRvTG93ZXJDYXNlKCkuaW5jbHVkZXMoJ3NhcXVlJykgPyAnc2FxdWUnIDogJ2RlcG9zaXRvJyxcclxuICAgICAgICBjYXRlZ29yaWE6ICdmaW5hbmNlaXJvJyxcclxuICAgICAgICB2YWxvcjogdmFsb3IsXHJcbiAgICAgICAgYXV0b3I6IG1lc3NhZ2UuYXV0aG9yIHx8ICdTaXN0ZW1hJyxcclxuICAgICAgICBkaXNwbGF5VGV4dDogY29udGVudC5zdWJzdHJpbmcoMCwgMTAwKSxcclxuICAgICAgfTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgLy8gUmV0dXJuIHVucGFyc2VkIG1lc3NhZ2VcclxuICAgIHJldHVybiB7XHJcbiAgICAgIC4uLm1lc3NhZ2UsXHJcbiAgICAgIHBhcnNlU3VjY2VzczogZmFsc2UsXHJcbiAgICAgIGNhdGVnb3JpYTogJ3Npc3RlbWEnLFxyXG4gICAgICBkaXNwbGF5VGV4dDogY29udGVudC5zdWJzdHJpbmcoMCwgMTAwKVxyXG4gICAgfTtcclxuICAgIFxyXG4gIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICBjb25zb2xlLmVycm9yKCdQYXJzZSBlcnJvcjonLCBlcnJvcik7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAuLi5tZXNzYWdlLFxyXG4gICAgICBwYXJzZVN1Y2Nlc3M6IGZhbHNlLFxyXG4gICAgICBjYXRlZ29yaWE6ICdzaXN0ZW1hJyxcclxuICAgICAgZGlzcGxheVRleHQ6IG1lc3NhZ2UuY29udGVudC5zdWJzdHJpbmcoMCwgMTAwKVxyXG4gICAgfTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBHRVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcclxuICB0cnkge1xyXG4gICAgY29uc3QgbWVzc2FnZXMgPSByZWFkTWVzc2FnZXMoKTtcclxuICAgIFxyXG4gICAgLy8gUGFyc2UgYWxsIG1lc3NhZ2VzIGFuZCByZXR1cm4gcGFyc2VkIGFjdGl2aXRpZXNcclxuICAgIGNvbnN0IHBhcnNlZE1lc3NhZ2VzID0gbWVzc2FnZXMubWFwKHBhcnNlRGlzY29yZE1lc3NhZ2UpO1xyXG4gICAgXHJcbiAgICBjb25zb2xlLmxvZyhg8J+TiiBQYXJzZWQgJHtwYXJzZWRNZXNzYWdlcy5sZW5ndGh9IG1lc3NhZ2VzLCAke3BhcnNlZE1lc3NhZ2VzLmZpbHRlcihtID0+IG0ucGFyc2VTdWNjZXNzKS5sZW5ndGh9IHN1Y2Nlc3NmdWxseSBwYXJzZWRgKTtcclxuICAgIFxyXG4gICAgcmV0dXJuIHdpdGhDb3JzKE5leHRSZXNwb25zZS5qc29uKHtcclxuICAgICAgc3VjY2VzczogdHJ1ZSxcclxuICAgICAgbWVzc2FnZXM6IHBhcnNlZE1lc3NhZ2VzLFxyXG4gICAgICB0b3RhbDogcGFyc2VkTWVzc2FnZXMubGVuZ3RoLFxyXG4gICAgICBsYXN0VXBkYXRlZDogbWVzc2FnZXMubGVuZ3RoID4gMCA/IG1lc3NhZ2VzWzBdPy50aW1lc3RhbXAgOiBudWxsLFxyXG4gICAgICBwYXJzZWQ6IHBhcnNlZE1lc3NhZ2VzLmZpbHRlcihtID0+IG0ucGFyc2VTdWNjZXNzKS5sZW5ndGhcclxuICAgIH0pKTtcclxuXHJcbiAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHJlYWRpbmcgbWVzc2FnZXM6JywgZXJyb3IpO1xyXG4gICAgcmV0dXJuIHdpdGhDb3JzKE5leHRSZXNwb25zZS5qc29uKFxyXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byByZWFkIG1lc3NhZ2VzJyB9LFxyXG4gICAgICB7IHN0YXR1czogNTAwIH1cclxuICAgICkpO1xyXG4gIH1cclxufSJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJmcyIsInBhdGgiLCJub3RpZnlDbGllbnRzIiwiY29yc0hlYWRlcnMiLCJ3aXRoQ29ycyIsInJlc3BvbnNlIiwiT2JqZWN0IiwiZW50cmllcyIsImZvckVhY2giLCJrZXkiLCJ2YWx1ZSIsImhlYWRlcnMiLCJzZXQiLCJNRVNTQUdFU19GSUxFIiwiam9pbiIsInByb2Nlc3MiLCJjd2QiLCJlbnN1cmVQdWJsaWNEaXJlY3RvcnkiLCJwdWJsaWNEaXIiLCJleGlzdHNTeW5jIiwibWtkaXJTeW5jIiwicmVjdXJzaXZlIiwicmVhZE1lc3NhZ2VzIiwiZmlsZUNvbnRlbnQiLCJyZWFkRmlsZVN5bmMiLCJkYXRhIiwiSlNPTiIsInBhcnNlIiwiQXJyYXkiLCJpc0FycmF5IiwibWVzc2FnZXMiLCJlcnJvciIsImNvbnNvbGUiLCJ3cml0ZU1lc3NhZ2VzIiwibGFzdFVwZGF0ZWQiLCJEYXRlIiwidG9JU09TdHJpbmciLCJ0b3RhbE1lc3NhZ2VzIiwibGVuZ3RoIiwid3JpdGVGaWxlU3luYyIsInN0cmluZ2lmeSIsImxvZyIsIlBPU1QiLCJyZXF1ZXN0IiwiYm9keSIsImpzb24iLCJjaGFubmVsSWQiLCJzdWNjZXNzIiwic3RhdHVzIiwiZXhpc3RpbmdNZXNzYWdlcyIsImV4aXN0aW5nSWRzIiwiU2V0IiwibWFwIiwibXNnIiwiaWQiLCJuZXdNZXNzYWdlcyIsImZpbHRlciIsImhhcyIsIm1zZ1RpbWVzdGFtcCIsInRpbWVzdGFtcCIsImdldFRpbWUiLCJkdXBsaWNhdGVCeVRpbWUiLCJzb21lIiwiZXhpc3RpbmciLCJNYXRoIiwiYWJzIiwiYXV0aG9yIiwibWVzc2FnZSIsInRvdGFsIiwiYWxsTWVzc2FnZXMiLCJyZWNlbnRNZXNzYWdlcyIsInNvcnQiLCJhIiwiYiIsInNsaWNlIiwibm90aWZpY2F0aW9uRmlsZSIsInVwZGF0ZUluZm8iLCJsYXN0VXBkYXRlIiwibm93IiwidHlwZSIsImNvdW50Iiwic3NlRXJyb3IiLCJ3YXJuIiwiT1BUSU9OUyIsIlJlc3BvbnNlIiwicGFyc2VEaXNjb3JkTWVzc2FnZSIsImNvbnRlbnQiLCJ0cmltIiwiY2FpeGFNYXRjaCIsIm1hdGNoIiwidHJhbnNhY3Rpb25UeXBlIiwiYWN0aW9uUGFydCIsImF1dG9yIiwiZGVwb3NpdFdpdGhBY3Rpb25NYXRjaCIsInZhbG9yIiwicGFyc2VGbG9hdCIsInJlcGxhY2UiLCJhY2FvIiwic2FsZG8iLCJwYXJzZVN1Y2Nlc3MiLCJ0aXBvIiwiY2F0ZWdvcmlhIiwiZGVzY3JpY2FvIiwiZGlzcGxheVRleHQiLCJ0b0ZpeGVkIiwiY29uZmlkZW5jZSIsIndpdGhkcmF3TWF0Y2giLCJzcGlkZXlCb3RNYXRjaCIsImFkZE1hdGNoIiwiaXRlbSIsInF1YW50aWRhZGUiLCJwYXJzZUludCIsInJlbW92ZU1hdGNoIiwiaXRlbUFkZFBhdHRlcm4iLCJpdGVtUmVtb3ZlUGF0dGVybiIsIm1vbmV5UGF0dGVybiIsImluY2x1ZGVzIiwidmFsb3JNYXRjaCIsImF1dG9yTWF0Y2giLCJhdXRvclNhcXVlIiwiYWNhb01hdGNoIiwidmVuZGV1TWF0Y2giLCJhdXRvckRlcG9zaXRvIiwibW9uZXlNYXRjaCIsInRvTG93ZXJDYXNlIiwic3Vic3RyaW5nIiwiR0VUIiwicGFyc2VkTWVzc2FnZXMiLCJtIiwicGFyc2VkIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/webhook/channel-messages/route.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/webhook/sse-manager.ts":
/*!****************************************!*\
  !*** ./app/api/webhook/sse-manager.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n// Global SSE client manager\nclass SSEManager {\n    constructor(){\n        this.clients = new Set();\n    }\n    static getInstance() {\n        if (!SSEManager.instance) {\n            SSEManager.instance = new SSEManager();\n        }\n        return SSEManager.instance;\n    }\n    addClient(controller) {\n        this.clients.add(controller);\n        console.log(`ðŸ“¡ SSE client connected. Total clients: ${this.clients.size}`);\n    }\n    removeClient(controller) {\n        this.clients.delete(controller);\n        console.log(`ðŸ“¡ SSE client disconnected. Total clients: ${this.clients.size}`);\n    }\n    notifyAll(data) {\n        const message = `data: ${JSON.stringify(data)}\\n\\n`;\n        const encoder = new TextEncoder();\n        const encoded = encoder.encode(message);\n        console.log(`ðŸ“¢ Notifying ${this.clients.size} SSE clients:`, data);\n        this.clients.forEach((controller)=>{\n            try {\n                controller.enqueue(encoded);\n            } catch (error) {\n                console.error(\"Failed to send to client, removing:\", error);\n                this.clients.delete(controller);\n            }\n        });\n    }\n    getClientCount() {\n        return this.clients.size;\n    }\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (SSEManager);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dlYmhvb2svc3NlLW1hbmFnZXIudHMiLCJtYXBwaW5ncyI6Ijs7OztBQUFBLDRCQUE0QjtBQUM1QixNQUFNQTtJQUlKLGFBQXNCO1FBQ3BCLElBQUksQ0FBQ0MsT0FBTyxHQUFHLElBQUlDO0lBQ3JCO0lBRUEsT0FBT0MsY0FBMEI7UUFDL0IsSUFBSSxDQUFDSCxXQUFXSSxRQUFRLEVBQUU7WUFDeEJKLFdBQVdJLFFBQVEsR0FBRyxJQUFJSjtRQUM1QjtRQUNBLE9BQU9BLFdBQVdJLFFBQVE7SUFDNUI7SUFFQUMsVUFBVUMsVUFBMkMsRUFBUTtRQUMzRCxJQUFJLENBQUNMLE9BQU8sQ0FBQ00sR0FBRyxDQUFDRDtRQUNqQkUsUUFBUUMsR0FBRyxDQUFDLENBQUMsd0NBQXdDLEVBQUUsSUFBSSxDQUFDUixPQUFPLENBQUNTLElBQUksQ0FBQyxDQUFDO0lBQzVFO0lBRUFDLGFBQWFMLFVBQTJDLEVBQVE7UUFDOUQsSUFBSSxDQUFDTCxPQUFPLENBQUNXLE1BQU0sQ0FBQ047UUFDcEJFLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLDJDQUEyQyxFQUFFLElBQUksQ0FBQ1IsT0FBTyxDQUFDUyxJQUFJLENBQUMsQ0FBQztJQUMvRTtJQUVBRyxVQUFVQyxJQUFTLEVBQVE7UUFDekIsTUFBTUMsVUFBVSxDQUFDLE1BQU0sRUFBRUMsS0FBS0MsU0FBUyxDQUFDSCxNQUFNLElBQUksQ0FBQztRQUNuRCxNQUFNSSxVQUFVLElBQUlDO1FBQ3BCLE1BQU1DLFVBQVVGLFFBQVFHLE1BQU0sQ0FBQ047UUFFL0JQLFFBQVFDLEdBQUcsQ0FBQyxDQUFDLGFBQWEsRUFBRSxJQUFJLENBQUNSLE9BQU8sQ0FBQ1MsSUFBSSxDQUFDLGFBQWEsQ0FBQyxFQUFFSTtRQUU5RCxJQUFJLENBQUNiLE9BQU8sQ0FBQ3FCLE9BQU8sQ0FBQ2hCLENBQUFBO1lBQ25CLElBQUk7Z0JBQ0ZBLFdBQVdpQixPQUFPLENBQUNIO1lBQ3JCLEVBQUUsT0FBT0ksT0FBTztnQkFDZGhCLFFBQVFnQixLQUFLLENBQUMsdUNBQXVDQTtnQkFDckQsSUFBSSxDQUFDdkIsT0FBTyxDQUFDVyxNQUFNLENBQUNOO1lBQ3RCO1FBQ0Y7SUFDRjtJQUVBbUIsaUJBQXlCO1FBQ3ZCLE9BQU8sSUFBSSxDQUFDeEIsT0FBTyxDQUFDUyxJQUFJO0lBQzFCO0FBQ0Y7QUFFQSxpRUFBZVYsVUFBVUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL3JlZG0tZGFzaGJvYXJkLy4vYXBwL2FwaS93ZWJob29rL3NzZS1tYW5hZ2VyLnRzP2JkYzciXSwic291cmNlc0NvbnRlbnQiOlsiLy8gR2xvYmFsIFNTRSBjbGllbnQgbWFuYWdlclxuY2xhc3MgU1NFTWFuYWdlciB7XG4gIHByaXZhdGUgc3RhdGljIGluc3RhbmNlOiBTU0VNYW5hZ2VyO1xuICBwcml2YXRlIGNsaWVudHM6IFNldDxSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyPjtcblxuICBwcml2YXRlIGNvbnN0cnVjdG9yKCkge1xuICAgIHRoaXMuY2xpZW50cyA9IG5ldyBTZXQoKTtcbiAgfVxuXG4gIHN0YXRpYyBnZXRJbnN0YW5jZSgpOiBTU0VNYW5hZ2VyIHtcbiAgICBpZiAoIVNTRU1hbmFnZXIuaW5zdGFuY2UpIHtcbiAgICAgIFNTRU1hbmFnZXIuaW5zdGFuY2UgPSBuZXcgU1NFTWFuYWdlcigpO1xuICAgIH1cbiAgICByZXR1cm4gU1NFTWFuYWdlci5pbnN0YW5jZTtcbiAgfVxuXG4gIGFkZENsaWVudChjb250cm9sbGVyOiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKTogdm9pZCB7XG4gICAgdGhpcy5jbGllbnRzLmFkZChjb250cm9sbGVyKTtcbiAgICBjb25zb2xlLmxvZyhg8J+ToSBTU0UgY2xpZW50IGNvbm5lY3RlZC4gVG90YWwgY2xpZW50czogJHt0aGlzLmNsaWVudHMuc2l6ZX1gKTtcbiAgfVxuXG4gIHJlbW92ZUNsaWVudChjb250cm9sbGVyOiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyKTogdm9pZCB7XG4gICAgdGhpcy5jbGllbnRzLmRlbGV0ZShjb250cm9sbGVyKTtcbiAgICBjb25zb2xlLmxvZyhg8J+ToSBTU0UgY2xpZW50IGRpc2Nvbm5lY3RlZC4gVG90YWwgY2xpZW50czogJHt0aGlzLmNsaWVudHMuc2l6ZX1gKTtcbiAgfVxuXG4gIG5vdGlmeUFsbChkYXRhOiBhbnkpOiB2b2lkIHtcbiAgICBjb25zdCBtZXNzYWdlID0gYGRhdGE6ICR7SlNPTi5zdHJpbmdpZnkoZGF0YSl9XFxuXFxuYDtcbiAgICBjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCk7XG4gICAgY29uc3QgZW5jb2RlZCA9IGVuY29kZXIuZW5jb2RlKG1lc3NhZ2UpO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKGDwn5OiIE5vdGlmeWluZyAke3RoaXMuY2xpZW50cy5zaXplfSBTU0UgY2xpZW50czpgLCBkYXRhKTtcbiAgICBcbiAgICB0aGlzLmNsaWVudHMuZm9yRWFjaChjb250cm9sbGVyID0+IHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVkKTtcbiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byBzZW5kIHRvIGNsaWVudCwgcmVtb3Zpbmc6JywgZXJyb3IpO1xuICAgICAgICB0aGlzLmNsaWVudHMuZGVsZXRlKGNvbnRyb2xsZXIpO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZ2V0Q2xpZW50Q291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5jbGllbnRzLnNpemU7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgU1NFTWFuYWdlcjsiXSwibmFtZXMiOlsiU1NFTWFuYWdlciIsImNsaWVudHMiLCJTZXQiLCJnZXRJbnN0YW5jZSIsImluc3RhbmNlIiwiYWRkQ2xpZW50IiwiY29udHJvbGxlciIsImFkZCIsImNvbnNvbGUiLCJsb2ciLCJzaXplIiwicmVtb3ZlQ2xpZW50IiwiZGVsZXRlIiwibm90aWZ5QWxsIiwiZGF0YSIsIm1lc3NhZ2UiLCJKU09OIiwic3RyaW5naWZ5IiwiZW5jb2RlciIsIlRleHRFbmNvZGVyIiwiZW5jb2RlZCIsImVuY29kZSIsImZvckVhY2giLCJlbnF1ZXVlIiwiZXJyb3IiLCJnZXRDbGllbnRDb3VudCJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/webhook/sse-manager.ts\n");

/***/ }),

/***/ "(rsc)/./app/api/webhook/sse/route.ts":
/*!**************************************!*\
  !*** ./app/api/webhook/sse/route.ts ***!
  \**************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   notifyClients: () => (/* binding */ notifyClients)\n/* harmony export */ });\n/* harmony import */ var _sse_manager__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! ../sse-manager */ \"(rsc)/./app/api/webhook/sse-manager.ts\");\n\nconst sseManager = _sse_manager__WEBPACK_IMPORTED_MODULE_0__[\"default\"].getInstance();\n// Export function to notify all clients\nfunction notifyClients(data) {\n    sseManager.notifyAll(data);\n}\nasync function GET(request) {\n    const responseStream = new ReadableStream({\n        start (controller) {\n            // Add client to manager\n            sseManager.addClient(controller);\n            // Send initial connection message\n            const encoder = new TextEncoder();\n            controller.enqueue(encoder.encode('data: {\"type\":\"connected\"}\\n\\n'));\n            // Send heartbeat every 30 seconds to keep connection alive\n            const heartbeat = setInterval(()=>{\n                try {\n                    const heartbeatMsg = encoder.encode('data: {\"type\":\"heartbeat\"}\\n\\n');\n                    controller.enqueue(heartbeatMsg);\n                } catch (error) {\n                    clearInterval(heartbeat);\n                    sseManager.removeClient(controller);\n                }\n            }, 30000);\n            // Clean up on disconnect\n            request.signal.addEventListener(\"abort\", ()=>{\n                clearInterval(heartbeat);\n                sseManager.removeClient(controller);\n                controller.close();\n            });\n        }\n    });\n    return new Response(responseStream, {\n        headers: {\n            \"Content-Type\": \"text/event-stream\",\n            \"Cache-Control\": \"no-cache\",\n            \"Connection\": \"keep-alive\",\n            \"Access-Control-Allow-Origin\": \"*\"\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9hcHAvYXBpL3dlYmhvb2svc3NlL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7OztBQUN3QztBQUV4QyxNQUFNQyxhQUFhRCxvREFBVUEsQ0FBQ0UsV0FBVztBQUV6Qyx3Q0FBd0M7QUFDakMsU0FBU0MsY0FBY0MsSUFBUztJQUNyQ0gsV0FBV0ksU0FBUyxDQUFDRDtBQUN2QjtBQUVPLGVBQWVFLElBQUlDLE9BQW9CO0lBQzVDLE1BQU1DLGlCQUFpQixJQUFJQyxlQUFlO1FBQ3hDQyxPQUFNQyxVQUFVO1lBQ2Qsd0JBQXdCO1lBQ3hCVixXQUFXVyxTQUFTLENBQUNEO1lBRXJCLGtDQUFrQztZQUNsQyxNQUFNRSxVQUFVLElBQUlDO1lBQ3BCSCxXQUFXSSxPQUFPLENBQUNGLFFBQVFHLE1BQU0sQ0FBQztZQUVsQywyREFBMkQ7WUFDM0QsTUFBTUMsWUFBWUMsWUFBWTtnQkFDNUIsSUFBSTtvQkFDRixNQUFNQyxlQUFlTixRQUFRRyxNQUFNLENBQUM7b0JBQ3BDTCxXQUFXSSxPQUFPLENBQUNJO2dCQUNyQixFQUFFLE9BQU9DLE9BQU87b0JBQ2RDLGNBQWNKO29CQUNkaEIsV0FBV3FCLFlBQVksQ0FBQ1g7Z0JBQzFCO1lBQ0YsR0FBRztZQUVILHlCQUF5QjtZQUN6QkosUUFBUWdCLE1BQU0sQ0FBQ0MsZ0JBQWdCLENBQUMsU0FBUztnQkFDdkNILGNBQWNKO2dCQUNkaEIsV0FBV3FCLFlBQVksQ0FBQ1g7Z0JBQ3hCQSxXQUFXYyxLQUFLO1lBQ2xCO1FBQ0Y7SUFDRjtJQUVBLE9BQU8sSUFBSUMsU0FBU2xCLGdCQUFnQjtRQUNsQ21CLFNBQVM7WUFDUCxnQkFBZ0I7WUFDaEIsaUJBQWlCO1lBQ2pCLGNBQWM7WUFDZCwrQkFBK0I7UUFDakM7SUFDRjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcmVkbS1kYXNoYm9hcmQvLi9hcHAvYXBpL3dlYmhvb2svc3NlL3JvdXRlLnRzPzMzZTAiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QgfSBmcm9tICduZXh0L3NlcnZlcic7XG5pbXBvcnQgU1NFTWFuYWdlciBmcm9tICcuLi9zc2UtbWFuYWdlcic7XG5cbmNvbnN0IHNzZU1hbmFnZXIgPSBTU0VNYW5hZ2VyLmdldEluc3RhbmNlKCk7XG5cbi8vIEV4cG9ydCBmdW5jdGlvbiB0byBub3RpZnkgYWxsIGNsaWVudHNcbmV4cG9ydCBmdW5jdGlvbiBub3RpZnlDbGllbnRzKGRhdGE6IGFueSkge1xuICBzc2VNYW5hZ2VyLm5vdGlmeUFsbChkYXRhKTtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICBjb25zdCByZXNwb25zZVN0cmVhbSA9IG5ldyBSZWFkYWJsZVN0cmVhbSh7XG4gICAgc3RhcnQoY29udHJvbGxlcikge1xuICAgICAgLy8gQWRkIGNsaWVudCB0byBtYW5hZ2VyXG4gICAgICBzc2VNYW5hZ2VyLmFkZENsaWVudChjb250cm9sbGVyKTtcbiAgICAgIFxuICAgICAgLy8gU2VuZCBpbml0aWFsIGNvbm5lY3Rpb24gbWVzc2FnZVxuICAgICAgY29uc3QgZW5jb2RlciA9IG5ldyBUZXh0RW5jb2RlcigpO1xuICAgICAgY29udHJvbGxlci5lbnF1ZXVlKGVuY29kZXIuZW5jb2RlKCdkYXRhOiB7XCJ0eXBlXCI6XCJjb25uZWN0ZWRcIn1cXG5cXG4nKSk7XG4gICAgICBcbiAgICAgIC8vIFNlbmQgaGVhcnRiZWF0IGV2ZXJ5IDMwIHNlY29uZHMgdG8ga2VlcCBjb25uZWN0aW9uIGFsaXZlXG4gICAgICBjb25zdCBoZWFydGJlYXQgPSBzZXRJbnRlcnZhbCgoKSA9PiB7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgY29uc3QgaGVhcnRiZWF0TXNnID0gZW5jb2Rlci5lbmNvZGUoJ2RhdGE6IHtcInR5cGVcIjpcImhlYXJ0YmVhdFwifVxcblxcbicpO1xuICAgICAgICAgIGNvbnRyb2xsZXIuZW5xdWV1ZShoZWFydGJlYXRNc2cpO1xuICAgICAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgICAgIGNsZWFySW50ZXJ2YWwoaGVhcnRiZWF0KTtcbiAgICAgICAgICBzc2VNYW5hZ2VyLnJlbW92ZUNsaWVudChjb250cm9sbGVyKTtcbiAgICAgICAgfVxuICAgICAgfSwgMzAwMDApO1xuICAgICAgXG4gICAgICAvLyBDbGVhbiB1cCBvbiBkaXNjb25uZWN0XG4gICAgICByZXF1ZXN0LnNpZ25hbC5hZGRFdmVudExpc3RlbmVyKCdhYm9ydCcsICgpID0+IHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChoZWFydGJlYXQpO1xuICAgICAgICBzc2VNYW5hZ2VyLnJlbW92ZUNsaWVudChjb250cm9sbGVyKTtcbiAgICAgICAgY29udHJvbGxlci5jbG9zZSgpO1xuICAgICAgfSk7XG4gICAgfSxcbiAgfSk7XG5cbiAgcmV0dXJuIG5ldyBSZXNwb25zZShyZXNwb25zZVN0cmVhbSwge1xuICAgIGhlYWRlcnM6IHtcbiAgICAgICdDb250ZW50LVR5cGUnOiAndGV4dC9ldmVudC1zdHJlYW0nLFxuICAgICAgJ0NhY2hlLUNvbnRyb2wnOiAnbm8tY2FjaGUnLFxuICAgICAgJ0Nvbm5lY3Rpb24nOiAna2VlcC1hbGl2ZScsXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonLFxuICAgIH0sXG4gIH0pO1xufSJdLCJuYW1lcyI6WyJTU0VNYW5hZ2VyIiwic3NlTWFuYWdlciIsImdldEluc3RhbmNlIiwibm90aWZ5Q2xpZW50cyIsImRhdGEiLCJub3RpZnlBbGwiLCJHRVQiLCJyZXF1ZXN0IiwicmVzcG9uc2VTdHJlYW0iLCJSZWFkYWJsZVN0cmVhbSIsInN0YXJ0IiwiY29udHJvbGxlciIsImFkZENsaWVudCIsImVuY29kZXIiLCJUZXh0RW5jb2RlciIsImVucXVldWUiLCJlbmNvZGUiLCJoZWFydGJlYXQiLCJzZXRJbnRlcnZhbCIsImhlYXJ0YmVhdE1zZyIsImVycm9yIiwiY2xlYXJJbnRlcnZhbCIsInJlbW92ZUNsaWVudCIsInNpZ25hbCIsImFkZEV2ZW50TGlzdGVuZXIiLCJjbG9zZSIsIlJlc3BvbnNlIiwiaGVhZGVycyJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./app/api/webhook/sse/route.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&page=%2Fapi%2Fwebhook%2Fchannel-messages%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fwebhook%2Fchannel-messages%2Froute.ts&appDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cjizar%5COneDrive%5CDocuments%5CDiscordBot%5Cfrontend&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();